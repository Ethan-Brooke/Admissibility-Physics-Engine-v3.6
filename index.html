<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admissibility Physics Engine v3.6</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
:root{--bg:#060810;--c1:#0b0f1a;--c2:#0e1322;--bdr:#171e30;--bdr2:#1f2940;--tx:#c8cedf;--dm:#4a5575;--br:#eef0f8;--grn:#34d399;--grng:#34d39920;--blu:#60a5fa;--blug:#60a5fa18;--pur:#a78bfa;--purg:#a78bfa15;--amb:#fbbf24;--ambg:#fbbf2415;--red:#f87171;--redg:#f8717115;--mn:'IBM Plex Mono',monospace;--sn:'IBM Plex Sans',sans-serif}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--sn);font-size:15px;background:var(--bg);color:var(--tx);line-height:1.55}
.ctr{max-width:1080px;margin:0 auto;padding:28px 20px}::selection{background:var(--grn);color:var(--bg)}
.hdr{margin-bottom:32px;position:relative}.hdr::after{content:'';position:absolute;bottom:-16px;left:0;width:100%;height:1px;background:linear-gradient(90deg,var(--grn),var(--blu),var(--pur),transparent 80%);opacity:.5}
.hdr-tag{font-family:var(--mn);font-size:12px;font-weight:600;color:var(--grn);letter-spacing:3px;text-transform:uppercase}
.hdr-t{font-size:28px;font-weight:700;color:var(--br);letter-spacing:-.5px;margin:2px 0 4px}.hdr-s{font-family:var(--mn);font-size:13px;color:var(--dm)}.hdr-s b{color:var(--grn);font-weight:500}
.sec{margin-bottom:48px}.sec-t{font-family:var(--mn);font-size:18px;font-weight:700;color:var(--br);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px;display:flex;align-items:center;gap:8px}.sec-intro{font-family:var(--mn);font-size:13px;color:var(--dm);line-height:1.6;margin-bottom:16px;max-width:700px}.sec-t::after{content:'';flex:1;height:1px;background:var(--bdr)}
.card{background:var(--c1);border:1px solid var(--bdr);border-radius:6px;padding:16px;margin-bottom:12px}.ct{font-family:var(--mn);font-size:12px;font-weight:600;color:var(--br);margin-bottom:10px;letter-spacing:.4px}
/* Summary grid */
.sg{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.sc{background:var(--c1);border:1px solid var(--bdr);border-radius:6px;overflow:hidden;cursor:pointer;transition:all .2s}.sc:hover{border-color:var(--bdr2);transform:translateY(-1px)}.sc.open{border-color:var(--bdr2)}
.sc::before{content:'';display:block;height:2px}.sc[data-a="g"]::before{background:var(--grn)}.sc[data-a="b"]::before{background:var(--blu)}.sc[data-a="p"]::before{background:var(--pur)}.sc[data-a="a"]::before{background:var(--amb)}
.sc-top{padding:13px 15px}.sc-l{font-family:var(--mn);font-size:13px;color:var(--dm);text-transform:uppercase;letter-spacing:1.5px}.sc-v{font-family:var(--mn);font-size:24px;font-weight:700;margin:1px 0}.sc-s{font-size:12px;color:var(--dm)}
.sc-arrow{float:right;font-size:12px;color:var(--dm);transition:transform .2s;margin-top:2px}.sc.open .sc-arrow{transform:rotate(180deg)}
.sc-expand{max-height:0;overflow:hidden;transition:max-height .35s ease}.sc.open .sc-expand{max-height:600px}.sc-inner{padding:0 15px 14px;border-top:1px solid var(--bdr)}
.mini-bar{display:flex;align-items:center;gap:4px;margin-bottom:3px;font-family:var(--mn);font-size:13px}.mini-bar-bg{flex:1;height:10px;background:var(--bdr);border-radius:2px;overflow:hidden}.mini-bar-fill{height:100%;border-radius:2px}
/* Budget panel */
.bp{background:var(--c1);border:1px solid var(--bdr);border-radius:8px;overflow:hidden;margin-bottom:14px}
.bp-hdr{padding:28px 24px 18px;background:linear-gradient(135deg,#0b0f1a 0%,#121830 100%);border-bottom:1px solid var(--bdr)}
.bp-tag{font-family:var(--mn);font-size:13px;color:var(--pur);letter-spacing:2px;text-transform:uppercase;margin-bottom:4px}
.bp-title{font-size:24px;font-weight:700;color:var(--br);line-height:1.2}.bp-title em{color:var(--grn);font-style:normal}
.bp-sub{font-family:var(--mn);font-size:12px;color:var(--dm);margin-top:6px;line-height:1.6}
.bp-quote{font-family:var(--sn);font-size:13px;font-style:italic;text-align:center;padding:14px 20px;color:var(--tx);border-bottom:1px solid var(--bdr)}.bp-quote em{color:var(--grn);font-style:italic}
.bp-stats{display:grid;grid-template-columns:repeat(5,1fr);border-bottom:1px solid var(--bdr)}
.bp-stat{padding:12px;text-align:center;border-right:1px solid var(--bdr);font-family:var(--mn)}.bp-stat:last-child{border-right:none}
.bp-stat-l{font-size:12px;color:var(--dm);text-transform:uppercase;letter-spacing:1px}.bp-stat-v{font-size:18px;font-weight:700;margin:2px 0}.bp-stat-s{font-size:12px;color:var(--dm)}
.bp-tabs{display:flex;border-bottom:1px solid var(--bdr);overflow-x:auto}.bp-tab{font-family:var(--mn);font-size:12px;padding:10px 16px;cursor:pointer;color:var(--dm);border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap}.bp-tab:hover{color:var(--tx)}.bp-tab.active{color:var(--br);border-bottom-color:var(--grn)}
.bp-panel{display:none;padding:20px 24px}.bp-panel.active{display:block}
.donut-wrap{display:flex;align-items:center;gap:28px;flex-wrap:wrap}.donut-legend{flex:1;min-width:200px}
.dl-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--bdr)}.dl-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}.dl-info{flex:1}.dl-name{font-size:13px;font-weight:600;color:var(--br)}.dl-tag{font-family:var(--mn);font-size:12px;padding:1px 5px;border-radius:3px;margin-left:6px}.dl-desc{font-family:var(--mn);font-size:13px;color:var(--dm);margin-top:1px}.dl-pct{font-family:var(--mn);font-size:16px;font-weight:700}
/* Expandable rows */
.xr{border:1px solid var(--bdr);border-radius:6px;margin-bottom:6px;overflow:hidden;transition:border-color .2s}
.xr:hover{border-color:var(--bdr2)}
.xr-top{display:grid;grid-template-columns:24px 1fr 70px 50px 50px 28px;gap:6px;align-items:center;padding:8px 12px;cursor:pointer;font-family:var(--mn);font-size:12px}
.xr-dot{width:8px;height:8px;border-radius:50%}.xr-q{color:var(--br);font-weight:600}.xr-val{color:var(--grn);text-align:right}
.xr-err{text-align:right;font-weight:600}
.xr-badge{font-size:13px;padding:2px 4px;border-radius:2px;text-align:center;font-weight:700;text-transform:uppercase}
.xr-arrow{text-align:center;color:var(--dm);font-size:13px;transition:transform .2s}.xr.open .xr-arrow{transform:rotate(180deg)}
.xr-expand{max-height:0;overflow:hidden;transition:max-height .3s ease}.xr.open .xr-expand{max-height:500px}
.xr.open>.toe-expand{max-height:400px}
.xr.open .xr-arrow{transform:rotate(180deg)}
.xr-detail{padding:10px 12px 14px;border-top:1px solid var(--bdr);font-family:var(--mn);font-size:13px;color:var(--dm);line-height:1.8}
.xd-row{display:flex;gap:8px;align-items:baseline}.xd-label{color:var(--tx);font-weight:600;min-width:85px;flex-shrink:0}
/* TOE table */
.toe-cat{font-family:var(--mn);font-size:13px;font-weight:600;color:var(--br);padding:8px 0 4px;border-bottom:2px solid var(--bdr);margin-top:14px}
.toe-cat:first-child{margin-top:0}
.toe-row{display:grid;grid-template-columns:24px minmax(120px,1fr) 115px 85px minmax(120px,1.2fr) 55px 52px 22px;gap:6px;align-items:center;padding:7px 10px;border-bottom:1px solid var(--bdr);font-family:var(--mn);font-size:12px;cursor:pointer;transition:background .15s}
.toe-row:hover{background:var(--blug)}
.toe-row .t-q{color:var(--br);font-weight:500}.toe-row .t-v{color:var(--grn);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.toe-row .t-e{text-align:right}
.toe-row .t-epi{font-size:13px;padding:2px 4px;border-radius:2px;font-weight:700;text-transform:uppercase;text-align:center}
.toe-row .t-arrow{text-align:center;color:var(--dm);font-size:12px;transition:transform .2s}
.toe-row.open .t-arrow{transform:rotate(180deg)}
.toe-expand{max-height:0;overflow:hidden;transition:max-height .3s ease;margin:0 8px}
.toe-row.open+.toe-expand{max-height:400px}
.toe-detail{padding:8px 10px 12px;font-family:var(--mn);font-size:13px;color:var(--dm);line-height:1.8;border-bottom:1px solid var(--bdr);border-left:3px solid var(--bdr);border-radius:0 0 0 4px;margin-bottom:4px;background:var(--bg)}
.toe-summary{display:flex;gap:16px;flex-wrap:wrap;margin:10px 0;font-family:var(--mn);font-size:12px}
.toe-summary .ts{padding:6px 12px;border-radius:4px;text-align:center}
/* Graphs */
#graph-box{width:100%;height:520px;background:var(--c1);border:1px solid var(--bdr);border-radius:6px;position:relative;overflow:hidden}#graph-box svg{width:100%;height:100%}
.gtt{position:absolute;pointer-events:none;font-family:var(--mn);font-size:13px;background:#111827ee;border:1px solid var(--bdr);border-radius:5px;padding:8px 11px;color:var(--br);max-width:260px;line-height:1.5;opacity:0;transition:opacity .15s;box-shadow:0 4px 20px rgba(0,0,0,.5);z-index:10}.gtt.show{opacity:1}.gtt .tt-id{font-weight:700;font-size:12px}.gtt .tt-dm{color:var(--dm);font-size:13px}
.gl{position:absolute;bottom:10px;left:10px;font-family:var(--mn);font-size:13px;background:#0b0f1acc;border:1px solid var(--bdr);border-radius:5px;padding:8px 10px;z-index:5}.gl-r{display:flex;align-items:center;gap:5px;margin-bottom:2px}.gl-d{width:8px;height:8px;border-radius:50%}
.gc{position:absolute;top:10px;right:10px;display:flex;gap:4px;z-index:5}.gc button{font-family:var(--mn);font-size:12px;background:#111827;border:1px solid var(--bdr);color:var(--dm);border-radius:4px;padding:4px 8px;cursor:pointer}.gc button:hover{color:var(--br);border-color:var(--grn)}
#dag-box{width:100%;overflow-x:auto;background:var(--c1);border:1px solid var(--bdr);border-radius:6px;padding:16px;position:relative}#dag-box svg text{font-family:'IBM Plex Mono',monospace}
#crystal-box{width:100%;height:560px;background:var(--c1);border:1px solid var(--bdr);border-radius:6px;position:relative;overflow:hidden;cursor:grab}#crystal-box:active{cursor:grabbing}
#crystal-legend{position:absolute;bottom:12px;left:12px;font-family:var(--mn);font-size:12px;background:#0b0f1add;border:1px solid var(--bdr);border-radius:5px;padding:8px 10px;pointer-events:none;line-height:1.6;z-index:5}
.cl-r{display:flex;align-items:center;gap:5px;margin-bottom:1px}.cl-dot{width:7px;height:7px;border-radius:50%}.cl-head{font-weight:600;color:var(--br);margin-bottom:2px;font-size:13px}
#crystal-hover{position:absolute;top:12px;left:12px;font-family:var(--mn);font-size:13px;color:var(--br);background:#111827ee;border:1px solid var(--bdr);border-radius:5px;padding:8px 11px;max-width:280px;opacity:0;transition:opacity .15s;pointer-events:none;z-index:10}
/* Audit */
.ar{display:grid;grid-template-columns:44px 1fr 64px;gap:6px;align-items:center;padding:5px 0;border-bottom:1px solid var(--bdr);font-size:13px}.ar-id{font-family:var(--mn);font-weight:600;color:var(--dm)}
.badge{font-family:var(--mn);font-size:12px;font-weight:700;padding:2px 5px;border-radius:3px;text-align:center;text-transform:uppercase}.b-fixed{background:var(--grng);color:var(--grn)}.b-active{background:var(--ambg);color:var(--amb)}.b-verified{background:var(--blug);color:var(--blu)}
/* Theorem map */
.tg{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:5px}.tc2{font-family:var(--mn);font-size:13px;padding:5px 7px;border-radius:4px;border:1px solid var(--bdr);line-height:1.3}.tc2 .tid{font-weight:700;color:var(--br)}.tc2 .tn2{color:var(--dm);font-size:12px;display:block;margin-top:1px}.tc2.ep-P{border-left:3px solid var(--grn)}.tc2.ep-Ps{border-left:3px solid var(--amb)}
.footer{font-family:var(--mn);font-size:13px;color:var(--dm);text-align:center;margin-top:32px;padding-top:14px;border-top:1px solid var(--bdr)}
.loading{display:flex;align-items:center;justify-content:center;min-height:400px;font-family:var(--mn);font-size:13px;color:var(--grn)}.loading::after{content:'';width:14px;height:14px;border:2px solid var(--grn);border-top-color:transparent;border-radius:50%;margin-left:8px;animation:sp .7s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
@media(max-width:700px){.sg{grid-template-columns:repeat(2,1fr)}.bp-stats{grid-template-columns:repeat(3,1fr)}#graph-box{height:400px}#crystal-box{height:400px}.toe-row{grid-template-columns:18px 1fr 65px 55px minmax(80px,1fr) 40px 40px 18px;font-size:8.5px}}

.t-u{color:var(--amb);font-style:italic;line-height:1.4}
.t-obs{color:var(--tx);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.toe-hdr{display:grid;grid-template-columns:24px minmax(120px,1fr) 115px 85px minmax(120px,1.2fr) 55px 52px 22px;gap:6px;padding:6px 10px;font-family:var(--mn);font-size:10px;font-weight:600;color:var(--dm);text-transform:uppercase;letter-spacing:.5px;border-bottom:2px solid var(--bdr);position:sticky;top:0;background:var(--cardbg);z-index:2}
.xr-name{color:var(--br);font-weight:600;font-family:var(--mn);font-size:12px}
.xr-desc{color:var(--dm);font-family:var(--mn);font-size:11px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.xr-tier{font-family:var(--mn);font-size:11px;font-weight:600}
.xr-top{display:grid;grid-template-columns:10px 90px 1fr 40px 55px 20px;gap:8px;align-items:center;padding:10px 12px;cursor:pointer}
</style>
<script>
MathJax = {
  tex: {inlineMath: [['$','$'],['\\(','\\)']]},
  svg: {fontCache:'global'},
  startup: {typeset: false}
};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-svg.min.js" async></script>

</head>
<body>
<div class="ctr" id="app"><div class="loading">Loading engine data</div></div>
<script>
var D={"version":"v3.6","date":"2026-02-07","total_theorems":49,"passed":49,"all_pass":true,"epistemic_counts":{"P":43,"P_structural":6},"sector_verdicts":{"gauge":true,"gravity":true,"rg_mechanism":true},"dependency_check":{"valid":true,"cycles":0,"issues":[]},"tier_stats":{"0":{"name":"Axiom Foundations","passed":9,"total":9},"1":{"name":"Gauge Group Selection","passed":3,"total":3},"2":{"name":"Particle Content","passed":9,"total":9},"3":{"name":"Continuous Constants / RG","passed":14,"total":14},"4":{"name":"Gravity + Dark Sector","passed":8,"total":8},"5":{"name":"Gamma_geo Closure","passed":6,"total":6}},"predictions":[{"quantity":"sin\u00b2\u03b8_W","predicted":"3/13 \u2248 0.23077","observed":"0.23122 \u00b1 0.00003","error_pct":0.19,"theorem":"T24","status":"derived"},{"quantity":"Gauge group","predicted":"SU(3)\u00d7SU(2)\u00d7U(1)","observed":"SU(3)\u00d7SU(2)\u00d7U(1)","error_pct":0.0,"theorem":"T_gauge","status":"exact"},{"quantity":"Generations","predicted":"3","observed":"3","error_pct":0.0,"theorem":"T7","status":"exact"},{"quantity":"Spacetime dim","predicted":"4","observed":"4","error_pct":0.0,"theorem":"T8","status":"exact"},{"quantity":"Higgs exists","predicted":"Yes (massive scalar)","observed":"Yes (125 GeV)","error_pct":0.0,"theorem":"T_Higgs","status":"exact"},{"quantity":"DM exists","predicted":"Yes (geometric)","observed":"Yes (\u03a9_DM \u2248 0.26)","error_pct":0.0,"theorem":"T12","status":"structural"},{"quantity":"\u039b > 0","predicted":"Yes (residual capacity)","observed":"Yes (\u039b \u2248 10\u207b\u00b9\u00b2\u00b2)","error_pct":0.0,"theorem":"T11","status":"structural"},{"quantity":"\u03a9_\u039b","predicted":"42/61 \u2248 0.6885","observed":"0.6889","error_pct":0.05,"theorem":"T11","status":"structural"},{"quantity":"\u03a9_m","predicted":"19/61 \u2248 0.3115","observed":"0.3111","error_pct":0.12,"theorem":"T11+T12E","status":"structural"},{"quantity":"\u03a9_b","predicted":"3/61 \u2248 0.04918","observed":"0.0490","error_pct":0.37,"theorem":"T12E","status":"structural"},{"quantity":"\u03a9_DM","predicted":"16/61 \u2248 0.2623","observed":"0.2607","error_pct":0.61,"theorem":"T12E","status":"structural"},{"quantity":"f_b (baryon fraction)","predicted":"3/19 \u2248 0.15789","observed":"0.1571","error_pct":0.49,"theorem":"T12E","status":"structural"},{"quantity":"Field content","predicted":"{Q,L,u,d,e} fundamental","observed":"{Q,L,u,d,e} fundamental","error_pct":0.0,"theorem":"T_field","status":"exact"},{"quantity":"Q_u (up quark charge)","predicted":"2/3","observed":"2/3","error_pct":0.0,"theorem":"T_field","status":"exact"},{"quantity":"Q_e (electron charge)","predicted":"-1","observed":"-1","error_pct":0.0,"theorem":"T_field","status":"exact"},{"quantity":"Q_\u03bd (neutrino charge)","predicted":"0","observed":"0","error_pct":0.0,"theorem":"T_field","status":"exact"},{"quantity":"Neutral atoms","predicted":"Q_p + Q_e = 0","observed":"|Q_p+Q_e| < 10\u207b\u00b2\u00b9","error_pct":0.0,"theorem":"T_field","status":"exact"},{"quantity":"Neutrino mass type","predicted":"Majorana (C_total=61 requires no \u03bd_R)","observed":"Unknown (0\u03bd\u03b2\u03b2 experiments ongoing)","error_pct":null,"theorem":"T11+T12E","status":"testable_prediction"},{"quantity":"Boson-multiplet identity","predicted":"N_gauge+N_Higgs = N_mult (12+4=16)","observed":"12+4=16 \u2713","error_pct":0.0,"theorem":"T_gauge+T_field+T_Higgs","status":"exact"},{"quantity":"N_gen consistency","predicted":"N_c\u00b2+6 = 5\u00d7N_gen (9+6=15=5\u00d73)","observed":"3 generations \u2713","error_pct":0.0,"theorem":"T_gauge+T4F","status":"exact"}],"audit_checks":[{"id":"A01","check":"Circular imports in theorem chain","status":"FIXED","severity":"critical"},{"id":"A02","check":"T26\u2192T27d circular dependency","status":"FIXED","severity":"critical"},{"id":"A03","check":"Stale P_structural labels (v3.6 upgrade)","status":"FIXED","severity":"high"},{"id":"A04","check":"L_\u03b5 disambiguation","status":"FIXED","severity":"high"},{"id":"A05","check":"T_sin2theta derivation chain","status":"FIXED","severity":"high"},{"id":"A06","check":"Import-gated C_structural labels","status":"FIXED","severity":"medium"},{"id":"A07","check":"Computational witnesses (V(\u03a6))","status":"ACTIVE","severity":"low"},{"id":"A08","check":"Anomaly scan exhaustiveness","status":"ACTIVE","severity":"low"},{"id":"A09","check":"Exit codes for CI","status":"ACTIVE","severity":"low"},{"id":"A10","check":"JSON export completeness","status":"FIXED","severity":"medium"},{"id":"A11","check":"Standalone module imports","status":"ACTIVE","severity":"low"},{"id":"A12","check":"Unicode gap classifier aliases","status":"FIXED","severity":"medium"},{"id":"A13","check":"Gamma_closure [P] depends on C_structural sub-theorem","status":"FIXED","severity":"high"},{"id":"A14","check":"T6B sin\u00b2\u03b8_W convergence gap (one-loop: 0.285 vs 0.231)","status":"FIXED","severity":"high"},{"id":"A15","check":"T_sin2theta independent of T6 (verified: T6 not in dep chain)","status":"FIXED","severity":"critical"},{"id":"A16","check":"C_structural -> P bridge upgrade (Lovelock + HKM pure math)","status":"FIXED","severity":"high"},{"id":"A17","check":"T0 axiom witnesses integrated (superadditivity \u0394=4, record-lock BFS)","status":"FIXED","severity":"medium"},{"id":"A18","check":"T_field [C] -> [P_structural] via anomaly uniqueness derivation","status":"FIXED","severity":"critical"},{"id":"A19","check":"T_channels\u2192T_field cycle (dependency arrow flipped)","status":"FIXED","severity":"critical"},{"id":"A20","check":"R12.1/R12.2 regime gates closed (singlet \u0394=0 + A5)","status":"FIXED","severity":"high"},{"id":"A21","check":"T12E reclassified: regime_dependent \u2192 open_physics \u2192 structural_step (f_b=3/19 combinatorial)","status":"FIXED","severity":"medium"},{"id":"A22","check":"T6 [P_structural] \u2192 [P]: SU(5) embedding is pure group theory (Georgi-Glashow)","status":"FIXED","severity":"high"},{"id":"A23","check":"T6B reclassified: qft_import \u2192 scale_identification (\u03b2-formula derived, scale map structural)","status":"FIXED","severity":"medium"},{"id":"A24","check":"T_field [P_structural] \u2192 [P]: Landau pole exclusion kills 6/8 reps, CPT kills 3bar, no A5 needed","status":"FIXED","severity":"critical"},{"id":"A25","check":"T12E f_b: \u03b3-calibration formula \u2192 combinatorial 3/19 (no free parameters, 0.49% error, removes UV gap dependency)","status":"FIXED","severity":"high"},{"id":"A26","check":"T11 \u039b: open_physics \u2192 structural_step, \u03a9_\u039b=42/61 (0.05% Planck). C_total=61 gives full budget: 3+16+42=61","status":"FIXED","severity":"critical"},{"id":"A27","check":"Majorana prediction: C_total=61 (no \u03bd_R) vs 64 (with \u03bd_R). Majorana gives 0.1% Planck; Dirac gives 10% error. Testable by 0\u03bd\u03b2\u03b2.","status":"ACTIVE","severity":"high"},{"id":"A28","check":"Boson-multiplet identity: N_gauge+N_Higgs=N_mult=16. Second N_gen derivation: N_c\u00b2+6=5\u00d7N_gen consistent with T4F.","status":"VERIFIED","severity":"high"}],"math_imports":{"Kochen-Specker (1967)":{"used_by":["T1"],"details":"No noncontextual hidden variable model for dim \u2265 3"},"GNS Construction (1943)":{"used_by":["T2"],"details":"Every state on a C*-algebra gives a *-representation on Hilbert space"},"Kadison / Hahn-Banach extension":{"used_by":["T2"],"details":"Positive functional on C*-subalgebra extends to full algebra"},"Skolem-Noether":{"used_by":["T3"],"details":"Every automorphism of M_n(C) is inner"},"Doplicher-Roberts (1989)":{"used_by":["T3"],"details":"Compact group G recovered from its symmetric tensor category"},"Bolzano-Weierstrass (compactness)":{"used_by":["L_\u03b5*"],"details":"Bounded sequences in R^n have convergent subsequences"},"Anomaly cancellation (Adler-Bell-Jackiw)":{"used_by":["T4"],"details":"Gauge anomalies cancel iff Tr[T_a{T_b,T_c}] = 0 for all generators"},"CPT theorem":{"used_by":["T_field"],"details":"Charge conjugation \u00d7 parity \u00d7 time reversal is an exact symmetry of any Lorentz-invariant unitary local QFT. From Lorentz invariance (Gamma_signature [P]) + unitarity (T2 [P]) + locality (T3 [P]). Pure mathematics."},"Symmetric group |S_k| = k!":{"used_by":["T9"],"details":"The symmetric group on k elements has exactly k! elements"},"Georgi-Glashow SU(5) embedding (1974)":{"used_by":["T6"],"details":"SU(5) is the minimal simple Lie group containing SU(3)\u00d7SU(2)\u00d7U(1) as maximal subgroup. Classification of simple Lie algebras and their maximal regular subalgebras \u2014 pure algebra."},"Polarization identity":{"used_by":["T7B"],"details":"Symmetric bilinear form uniquely determined by quadratic form"},"Pigeonhole principle":{"used_by":["T8"],"details":"Integer capacity partitioning excludes d<=3 and d>=5"},"Lovelock theorem (1971)":{"used_by":["T9_grav"],"details":"Unique 2nd-order divergence-free symmetric (0,2)-tensor in d=4"},"Fundamental Theorem of Riemannian Geometry":{"used_by":["T9_grav"],"details":"Unique torsion-free metric-compatible connection"},"Intermediate Value Theorem":{"used_by":["T_particle"],"details":"Continuous V(Phi) with V(0)=0, V->-inf ensures minimum exists"},"Second Derivative Test":{"used_by":["T_particle"],"details":"d2V/dPhi2 > 0 at minimum confirms mass gap"}},"p_structural_reasons":{"T4G":"open_physics","T4G_Q31":"open_physics","T6B":"scale_identification","T10":"open_physics","T11":"structural_step","T12E":"structural_step"},"theorems":{"T0":{"name":"T0: Axiom Witness Certificates (Canonical v4)","tier":0,"passed":true,"epistemic":"P","key_result":"Axiom witnesses: \u0394=4 (superadditivity), record-lock (irreversibility)","gap_type":"closed","dependencies":["A1","A2","A4"]},"T1":{"name":"T1: Non-Closure \u2192 Measurement Obstruction","tier":0,"passed":true,"epistemic":"P","key_result":"Non-closure \u27f9 \u2203 incompatible observables","gap_type":"closed","dependencies":["A2 (non-closure)"],"imported_theorems":["Kochen-Specker (1967)"]},"T2":{"name":"T2: Non-Closure \u2192 Operator Algebra","tier":0,"passed":true,"epistemic":"P","key_result":"Non-closure \u27f9 C*-algebra on Hilbert space (state existence proved)","gap_type":"closed","dependencies":["T1","A1 (finite capacity)","A2 (non-closure)"],"imported_theorems":["GNS Construction (1943)","Kadison / Hahn-Banach extension"]},"T3":{"name":"T3: Locality \u2192 Gauge Structure","tier":0,"passed":true,"epistemic":"P","key_result":"Locality + operator algebra \u27f9 gauge bundle + connection","gap_type":"closed","dependencies":["T2","A3 (locality)"],"imported_theorems":["Skolem-Noether","Doplicher-Roberts (1989)"]},"L_\u03b5*":{"name":"L_\u03b5*: Minimum Enforceable Distinction","tier":0,"passed":true,"epistemic":"P","key_result":"\u03b5_\u0393 > 0: meaningful distinctions have minimum enforcement cost","gap_type":"closed","dependencies":["A1 (finite capacity)","meaning = robustness (definitional)"],"imported_theorems":["Bolzano-Weierstrass (compactness)"]},"T_\u03b5":{"name":"T_\u03b5: Enforcement Granularity","tier":0,"passed":true,"epistemic":"P","key_result":"\u03b5 = min nonzero enforcement cost > 0","gap_type":"closed","dependencies":["L_\u03b5*","A1 (finite capacity)"]},"T_\u03b7":{"name":"T_\u03b7: Subordination Bound","tier":0,"passed":true,"epistemic":"P","key_result":"\u03b7/\u03b5 \u2264 1","gap_type":"closed","dependencies":["T_\u03b5","T_M","A1","A3"]},"T_\u03ba":{"name":"T_\u03ba: Directed Enforcement Multiplier","tier":0,"passed":true,"epistemic":"P","key_result":"\u03ba = 2","gap_type":"closed","dependencies":["T_\u03b5","A4","A5"]},"T_M":{"name":"T_M: Interface Monogamy","tier":0,"passed":true,"epistemic":"P","key_result":"Independence \u27fa disjoint anchors","gap_type":"closed","dependencies":["A1","A3","L_\u03b5*"]},"T4":{"name":"T4: Minimal Anomaly-Free Chiral Gauge Net","tier":1,"passed":true,"epistemic":"P","key_result":"Gauge structure = SU(N_c) \u00d7 SU(2) \u00d7 U(1)","gap_type":"closed","dependencies":["T3","A1","A2"],"imported_theorems":["Anomaly cancellation (Adler-Bell-Jackiw)"]},"T5":{"name":"T5: Minimal Anomaly-Free Matter Completion","tier":1,"passed":true,"epistemic":"P","key_result":"Hypercharge ratios uniquely determined (quadratic proof)","gap_type":"closed","dependencies":["T4"]},"T_gauge":{"name":"T_gauge: Gauge Group from Capacity Budget","tier":1,"passed":true,"epistemic":"P","key_result":"SU(3)\u00d7SU(2)\u00d7U(1) = capacity-optimal (dim=12)","gap_type":"closed","dependencies":["T4","T5","A1"]},"T_field":{"name":"T_field: Field Content (Anomaly + UV Safety Uniqueness)","tier":2,"passed":true,"epistemic":"P","key_result":"Field content + hypercharges + electric charges uniquely derived (no free parameters)","gap_type":"closed","dependencies":["T_gauge","T4","T_channels","T4F","A1","T1","T2","T3"],"imported_theorems":["CPT theorem"]},"T_channels":{"name":"T_channels: Channel Count","tier":2,"passed":true,"epistemic":"P","key_result":"channels_EW = 4 [P]","gap_type":"closed","dependencies":["T_gauge","T5"]},"T7":{"name":"T7: Generation Bound","tier":2,"passed":true,"epistemic":"P","key_result":"N_gen = 3 [P]","gap_type":"closed","dependencies":["T_\u03ba","T_channels","T_\u03b7"]},"T4E":{"name":"T4E: Generation Structure (Upgraded)","tier":2,"passed":true,"epistemic":"P","key_result":"3 generations with hierarchical structure","gap_type":"closed","dependencies":["T7","T_\u03b7"]},"T4F":{"name":"T4F: Flavor-Capacity Saturation","tier":2,"passed":true,"epistemic":"P","key_result":"Saturation = 75% (near-full)","gap_type":"closed","dependencies":["T7"]},"T4G":{"name":"T4G: Yukawa Structure","tier":2,"passed":true,"epistemic":"P_structural","key_result":"y_f ~ exp(\u2212E_f/T): mass hierarchy from enforcement cost","gap_type":"open_physics","dependencies":["T4E","T_\u03b5"],"ps_reason":"open_physics"},"T4G_Q31":{"name":"T4G-Q31: Neutrino Mass Bound","tier":2,"passed":true,"epistemic":"P_structural","key_result":"\u03a3m_\u03bd bounded by capacity constraint","gap_type":"open_physics","dependencies":["T4G","A1"],"ps_reason":"open_physics"},"T_Higgs":{"name":"T_Higgs: Massive Scalar from EW Pivot","tier":2,"passed":true,"epistemic":"P","key_result":"Massive Higgs-like scalar required [P_structural]; Coulomb 1/v\u00b2 gives bridge 0.4% from m_H/m_P [W]","gap_type":"closed","dependencies":["T_particle","A4","A1","T_gauge","T_channels"]},"T9":{"name":"T9: k! Record Sectors","tier":2,"passed":true,"epistemic":"P","key_result":"3! = 6 orthogonal record sectors","gap_type":"closed","dependencies":["A4","T7"],"imported_theorems":["Symmetric group |S_k| = k!"]},"T6":{"name":"T6: EW Mixing at Unification","tier":3,"passed":true,"epistemic":"P","key_result":"sin\u00b2\u03b8_W(M_U) = 3/8 (pure group theory)","gap_type":"closed","dependencies":["T_gauge"],"imported_theorems":["Georgi-Glashow SU(5) embedding (1974)"]},"T6B":{"name":"T6B: Capacity RG Running","tier":3,"passed":true,"epistemic":"P_structural","key_result":"sin\u00b2\u03b8_W runs from 0.375; one-loop lands ~0.285 (threshold gap acknowledged)","gap_type":"scale_id","dependencies":["T6","T_field","T1","T2","T3"],"ps_reason":"scale_identification"},"T19":{"name":"T19: Routing Sectors","tier":3,"passed":true,"epistemic":"P","key_result":"M = 3 routing sectors","gap_type":"closed","dependencies":["T_channels","T_field"]},"T20":{"name":"T20: RG = Enforcement Flow","tier":3,"passed":true,"epistemic":"P","key_result":"RG \u2261 enforcement cost renormalization","gap_type":"closed","dependencies":["A1","T3"]},"T21":{"name":"T21: \u03b2-Function from Saturation","tier":3,"passed":true,"epistemic":"P","key_result":"\u03b2_i = \u2212\u03b3_i w_i + \u03bb w_i \u03a3_j a_ij w_j","gap_type":"closed","dependencies":["T20","A2"]},"T22":{"name":"T22: Competition Matrix","tier":3,"passed":true,"epistemic":"P","key_result":"a = [[1,0],[0,3]]","gap_type":"closed","dependencies":["T19","T21"]},"T23":{"name":"T23: Fixed-Point Formula","tier":3,"passed":true,"epistemic":"P","key_result":"sin\u00b2\u03b8_W* = r*/(1+r*) [structural formula]","gap_type":"closed","dependencies":["T21","T22"]},"T24":{"name":"T24: sin\u00b2\u03b8_W = 3/13","tier":3,"passed":true,"epistemic":"P","key_result":"sin\u00b2\u03b8_W = 3/13 \u2248 0.2308 (0.19% error)","gap_type":"closed","dependencies":["T23","T27c","T27d","T22"]},"T25a":{"name":"T25a: Overlap Bounds","tier":3,"passed":true,"epistemic":"P","key_result":"x \u2208 [1/3, 2/3]","gap_type":"closed","dependencies":["T_M","T_channels"]},"T25b":{"name":"T25b: Overlap from Saturation","tier":3,"passed":true,"epistemic":"P","key_result":"Saturation pushes x \u2192 1/2","gap_type":"closed","dependencies":["T25a","T4F"]},"T26":{"name":"T26: Gamma Ratio Bounds","tier":3,"passed":true,"epistemic":"P","key_result":"\u03b3\u2082/\u03b3\u2081 \u2265 3, exact = 17/4 (T27d)","gap_type":"closed","dependencies":["T21","A1"]},"T27c":{"name":"T27c: x = 1/2","tier":3,"passed":true,"epistemic":"P","key_result":"x = 1/2","gap_type":"closed","dependencies":["T25a","T_gauge"]},"T27d":{"name":"T27d: \u03b3\u2082/\u03b3\u2081 = d + 1/d","tier":3,"passed":true,"epistemic":"P","key_result":"\u03b3\u2082/\u03b3\u2081 = 17/4","gap_type":"closed","dependencies":["T26","T_channels","\u0393_closure"]},"T_sin2theta":{"name":"T_sin2theta: Weinberg Angle","tier":3,"passed":true,"epistemic":"P","key_result":"sin\u00b2\u03b8_W = 3/13 [P]","gap_type":"closed","dependencies":["T23","T27c","T27d","T24"]},"T7B":{"name":"T7B: Gravity from Non-Factorization (Lemma 7B)","tier":4,"passed":true,"epistemic":"P","key_result":"Shared interface -> metric tensor g_uv","gap_type":"closed","dependencies":["T3","A1","A4"],"imported_theorems":["Polarization identity"]},"T8":{"name":"T8: Spacetime Dimension d = 4","tier":4,"passed":true,"epistemic":"P","key_result":"d = 4 spacetime dimensions","gap_type":"closed","dependencies":["T_gauge","A1","A5"],"imported_theorems":["Pigeonhole principle"]},"T9_grav":{"name":"T9: Einstein Field Equations","tier":4,"passed":true,"epistemic":"P","key_result":"G_uv + Lambda*g_uv = kappa*T_uv (Lovelock)","gap_type":"closed","dependencies":["T7B","T8","Gamma_closure"],"imported_theorems":["Lovelock theorem (1971)","Fundamental Theorem of Riemannian Geometry"]},"T10":{"name":"T10: Gravitational Coupling kappa ~ 1/C_*","tier":4,"passed":true,"epistemic":"P_structural","key_result":"kappa ~ 1/C_* (structural)","gap_type":"open_physics","dependencies":["T9_grav","A1"],"ps_reason":"open_physics"},"T11":{"name":"T11: Cosmological Constant (Capacity Residual Fraction)","tier":4,"passed":true,"epistemic":"P_structural","key_result":"\u03a9_\u039b = 42/61 = 0.6885 (obs: 0.6889, error 0.05%)","gap_type":"reduced","dependencies":["T9_grav","T4F","T_field","T_gauge","T_Higgs","T12E","A5"],"ps_reason":"structural_step"},"T_particle":{"name":"T_particle: Mass Gap & Particle Emergence","tier":4,"passed":true,"epistemic":"P","key_result":"SSB forced, mass gap from V(Phi), particles = quantum modes","gap_type":"closed","dependencies":["L_e*","T_M","A1","A4","T1","T2"],"imported_theorems":["Intermediate Value Theorem","Second Derivative Test"]},"Gamma_ordering":{"name":"Gamma_ordering: Ledger Ordering (R1-R4)","tier":5,"passed":true,"epistemic":"P","key_result":"R1-R4 all derived from A4 + L_epsilon*","gap_type":"closed","dependencies":["A4","L_epsilon*"]},"Gamma_fbc":{"name":"Gamma_fbc: Fluctuation Bound (Lipschitz)","tier":5,"passed":true,"epistemic":"P","key_result":"|Delta^2 Phi| <= K/N^2 (Lipschitz + source bound)","gap_type":"closed","dependencies":["A1","A4","L_epsilon*"]},"Gamma_continuum":{"name":"Gamma_continuum: Continuum Limit (Kolmogorov)","tier":5,"passed":true,"epistemic":"P","key_result":"Lattice -> C^2 metric -> smooth manifold M1","gap_type":"closed","dependencies":["A1","A4","Gamma_ordering","Gamma_fbc"]},"Gamma_signature":{"name":"Gamma_signature: Lorentzian Signature (HKM)","tier":5,"passed":true,"epistemic":"P","key_result":"Signature (-,+,+,+) from A4 + HKM + Malament","gap_type":"closed","dependencies":["A4","A1","Gamma_continuum"]},"Gamma_particle":{"name":"Gamma_particle: Particle Emergence (V(Phi))","tier":5,"passed":true,"epistemic":"P","key_result":"SSB forced, mass gap = 0.53, well at Phi/C ~ 0.01","gap_type":"closed","dependencies":["L_epsilon*","T_M","A1","A4"]},"Gamma_closure":{"name":"Gamma_closure: Full Closure (10/10 Einstein pre-conditions)","tier":5,"passed":true,"epistemic":"P","key_result":"10/10 Einstein conditions, 5/5 sub-theorems","gap_type":"closed","dependencies":["Gamma_ordering","Gamma_fbc","Gamma_continuum","Gamma_signature","Gamma_particle"]},"T12":{"name":"T12: Dark Matter Existence (Capacity Residual)","tier":4,"passed":true,"epistemic":"P","key_result":"DM exists: C_ext > 0 is gauge-singlet (proven from A1 + T_gauge)","gap_type":"closed","dependencies":["A1","A5","T_gauge","T0"]},"T12E":{"name":"T12E: Baryon Fraction (Minimal Witness Combinatorial)","tier":4,"passed":true,"epistemic":"P_structural","key_result":"f_b = 3/19 = 0.157895 (obs: 0.15713, error 0.49%)","gap_type":"reduced","dependencies":["T12","T4F","T_field","T_Higgs","T4G","A5"],"ps_reason":"structural_step"}}};
var TOE=[{"cat":"Gauge Structure","q":"Gauge group","sym":"SU(3)\u00d7SU(2)\u00d7U(1)","fcf":"exact","obs":"exact","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Gauge (T_gauge)","thm":"T_gauge","adm":"Unique factorization of C\u226512 satisfying A2+A3+A5. No other product group is admissible.","falsify":"Discovery of additional gauge bosons (Z', W') not from SSB would require larger group.","indep":"Derived from axioms alone via capacity budget + anomaly cancellation.","unit":"capacity partition"},{"cat":"Gauge Structure","q":"Quark colors N_c","sym":"3","fcf":"3","obs":"3","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Gauge","thm":"T_gauge","adm":"Largest simple factor in the minimal admissible gauge group. SU(3) from non-abelian locality.","falsify":"Observation of fractional-charge free quarks would indicate deconfinement beyond SU(3).","indep":"Component of gauge group derivation.","unit":"capacity measure"},{"cat":"Gauge Structure","q":"Weak isospin N_w","sym":"2","fcf":"2","obs":"2","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Gauge","thm":"T_gauge","adm":"Chiral routing requires exactly SU(2). SU(3)_weak would overconsume capacity.","falsify":"Detection of additional weak bosons not from SSB.","indep":"Component of gauge group derivation.","unit":"enforcement channels"},{"cat":"Gauge Structure","q":"Abelian factors","sym":"1","fcf":"1","obs":"1","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Gauge","thm":"T_gauge","adm":"Single U(1) hypercharge. Additional U(1) factors create Landau poles violating A1.","falsify":"Discovery of a dark photon from a second U(1).","indep":"Component of gauge group derivation.","unit":"capacity measure"},{"cat":"Spacetime","q":"Spacetime dimension","sym":"d=4","fcf":"4","obs":"4","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Geometry (T8)","thm":"T8","adm":"Unique d where Weyl spinors are 2-component and compatible with gauge structure. d>4 creates KK modes violating A1.","falsify":"Detection of large extra dimensions at colliders.","indep":"Derived from spinor + gauge compatibility, independent of matter content.","unit":"propagating DOF minimum"},{"cat":"Spacetime","q":"Metric signature","sym":"(\u2212,+,+,+)","fcf":"Lorentzian","obs":"Lorentzian","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Geometry","thm":"T8","adm":"Causal propagation (A4) requires exactly one timelike dimension.","falsify":"Observation of acausal signal propagation.","indep":"From irreversibility axiom A4 alone.","unit":"capacity measure"},{"cat":"Spacetime","q":"Graviton spin","sym":"s=2","fcf":"2","obs":"2","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Gravity (T9_grav)","thm":"T9_grav","adm":"Metric = capacity geometry. Perturbation of symmetric 2-tensor \u2192 spin-2 massless mode.","falsify":"Detection of massive graviton or spin\u22602 gravitational mode.","indep":"From non-factorization of capacity graph.","unit":"metric tensor rank"},{"cat":"Spacetime","q":"Time asymmetry","sym":"\u0394t>0","fcf":"exists","obs":"exists","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Causal (T0)","thm":"T0","adm":"Ledger monotonicity from A4 (irreversibility) \u2192 thermodynamic arrow.","falsify":"Observation of macroscopic time-reversal.","indep":"Direct from A4.","unit":"enforcement arrow"},{"cat":"Matter Content","q":"Fermion generations","sym":"N_gen=3","fcf":"3","obs":"3","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Capacity (T4F)","thm":"T4F","adm":"3 gens exhaust 45/61 Weyl DOF. 4th requires C\u226576, violating A1. Algebraically: N\u00b2+6=5N \u2192 N=3.","falsify":"Discovery of a 4th-generation fermion at any mass.","indep":"From capacity saturation, independent of gauge or cosmology.","unit":"capacity saturation bound"},{"cat":"Matter Content","q":"Field content","sym":"{Q,L,u,d,e}","fcf":"exact","obs":"exact","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Anomaly (T_field)","thm":"T_field","adm":"Unique chiral Weyl set cancelling all gauge anomalies (A2), avoiding Landau poles (A1).","falsify":"Discovery of new chiral fermion not in this set.","indep":"From anomaly cancellation + asymptotic safety.","unit":"anomaly-free multiplet"},{"cat":"Matter Content","q":"Higgs exists","sym":"scalar","fcf":"yes","obs":"yes","err":0,"errS":"exact","epi":"P","regime":"EW pivot","sector":"Higgs (T_Higgs)","thm":"T_Higgs","adm":"EW pivot requires massive scalar to redistribute capacity. Unique bridge making EWSB admissible.","falsify":"If EWSB occurred without a fundamental scalar (technicolor-like).","indep":"From capacity redistribution requirement at EW scale.","unit":"SSB enforcement scalar"},{"cat":"Charges","q":"Up quark charge","sym":"Q_u=+2/3","fcf":"2/3","obs":"2/3","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Anomaly","thm":"T_field","adm":"Anomaly cancellation Diophantine system has unique rational solution. Not a choice.","falsify":"Measurement of irrational or non-third-integer quark charges.","indep":"From anomaly cancellation.","unit":"quantized hypercharge"},{"cat":"Charges","q":"Electron charge","sym":"Q_e=\u22121","fcf":"\u22121","obs":"\u22121","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Anomaly","thm":"T_field","adm":"Same Diophantine system. Lepton charge = \u22121 is forced.","falsify":"Same as Q_u.","indep":"From anomaly cancellation.","unit":"quantized hypercharge"},{"cat":"Charges","q":"Neutrino charge","sym":"Q_\u03bd=0","fcf":"0","obs":"0","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Anomaly","thm":"T_field","adm":"Unique neutral member of the lepton doublet.","falsify":"Discovery of neutrino electric charge (millicharge).","indep":"From anomaly cancellation.","unit":"quantized hypercharge"},{"cat":"Charges","q":"Neutral atoms","sym":"Q_p+Q_e=0","fcf":"exact","obs":"exact","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Cross-check","thm":"T_field","adm":"Q_p=2(2/3)+(\u22121/3)=1, Q_e=\u22121. Exact cancellation from enforcement consistency.","falsify":"Detection of proton-electron charge asymmetry (tested to 10\u207b\u00b2\u00b9).","indep":"Corollary of charge quantization.","unit":"anomaly cancellation"},{"cat":"Electroweak","q":"sin\u00b2\u03b8_W","sym":"3/13","fcf":"0.23077","obs":"0.23122","err":0.19,"errS":"0.19%","epi":"P","regime":"EW near-saturation","sector":"EW (T_sin2theta)","thm":"T_sin2theta","adm":"Ratio of non-abelian enforcement channels at capacity fixed point. 3=dim(SU(2))\u22121; 13=total directional cost.","falsify":"If SU(2) saturation were not reached at EW scale, 3/13 would shift.","indep":"EW sector only. Independent of cosmology.","unit":"capacity ratio (RG fixed point)"},{"cat":"Electroweak","q":"W/Z mass ratio","sym":"M_W/M_Z=cos \u03b8_W","fcf":"0.8769","obs":"0.8815","err":0.52,"errS":"0.52%","epi":"P","regime":"EW","sector":"EW","thm":"T_sin2theta","adm":"Direct consequence of sin\u00b2\u03b8_W = 3/13. The Weinberg relation M_W = M_Z cos \u03b8_W is structural.","falsify":"Same as sin\u00b2\u03b8_W \u2014 any deviation in one implies deviation in other.","indep":"Corollary of sin\u00b2\u03b8_W.","unit":"EW mixing cosine"},{"cat":"Cosmology","q":"\u03a9_\u039b","sym":"42/61","fcf":"0.6885","obs":"0.6889","err":0.05,"errS":"0.05%","epi":"P_structural","regime":"R11 (horizon saturation)","sector":"Vacuum ledger (T11)","thm":"T11","adm":"42 structural vacuum DOF: 27 gauge-index slots + 3 Higgs internals + 12 generators. No distinguishable labels.","falsify":"If vacuum energy were field-dependent (quintessence), this ratio would run with redshift.","indep":"Vacuum capacity residual. Independent of matter counting.","unit":"vacuum capacity residual"},{"cat":"Cosmology","q":"\u03a9_m","sym":"19/61","fcf":"0.3115","obs":"0.3111","err":0.12,"errS":"0.12%","epi":"P_structural","regime":"R11+R12","sector":"Matter ledger (T12E)","thm":"T12E","adm":"19 matter-sector capacity: 3 gen labels + 16 multiplet refs. Capacity carrying distinguishable information.","falsify":"Additional light species (sterile \u03bd, axions) would shift this upward.","indep":"Cross-checks against \u03a9_\u039b = 1\u2212\u03a9_m.","unit":"labeled capacity fraction"},{"cat":"Cosmology","q":"\u03a9_b","sym":"3/61","fcf":"0.04918","obs":"0.0490","err":0.37,"errS":"0.37%","epi":"P_structural","regime":"R12 (baryon counting)","sector":"Baryon ledger (T12E)","thm":"T12E","adm":"Capacity carrying flavor quantum numbers = N_gen = 3 generation labels.","falsify":"4th generation at any mass \u2192 4/X. Discovery of baryonic dark matter \u2192 ratio shifts.","indep":"From generation count (T4F). Independent of dark sector.","unit":"generation-weighted capacity"},{"cat":"Cosmology","q":"\u03a9_DM","sym":"16/61","fcf":"0.2623","obs":"0.2607","err":0.61,"errS":"0.61%","epi":"P_structural","regime":"R12 (dark counting)","sector":"Dark matter ledger (T12E)","thm":"T12E","adm":"16 enforcement references: 5 multiplets \u00d7 3 gens + 1 Higgs. No gauge charge \u2192 dark.","falsify":"If DM carried SM gauge charge, the labeled/unlabeled partition breaks.","indep":"From field content (T_field). Independent of \u039b calculation.","unit":"unlabeled geometric capacity"},{"cat":"Cosmology","q":"f_b = \u03a9_b/\u03a9_m","sym":"3/19","fcf":"0.15789","obs":"0.1571","err":0.49,"errS":"0.49%","epi":"P_structural","regime":"R12","sector":"Cross-ledger ratio","thm":"T12E","adm":"Baryon fraction = flavor-labeled / total matter. Pure combinatorics.","falsify":"Same as \u03a9_b and \u03a9_DM \u2014 any change to field content shifts this.","indep":"Redundant cross-check of \u03a9_b and \u03a9_m.","unit":"generation / multiplet ratio"},{"cat":"Cosmology","q":"DM exists","sym":"geometric","fcf":"yes","obs":"yes","err":0,"errS":"exact","epi":"P_structural","regime":"R12","sector":"Dark matter","thm":"T12","adm":"16 enforcement refs carry capacity but no gauge charge \u2192 gravitationally active, photon-invisible.","falsify":"If all matter were gauge-charged (no enforcement overhead).","indep":"Structural consequence of field content.","unit":"gauge-singlet capacity excess"},{"cat":"Cosmology","q":"\u039b > 0","sym":"residual","fcf":"yes","obs":"yes","err":0,"errS":"exact","epi":"P_structural","regime":"R11","sector":"Vacuum","thm":"T11","adm":"42 unlabeled capacity entries = nonzero vacuum energy. \u039b=0 requires C_vac=0, violating DOF budget.","falsify":"If vacuum had zero structural capacity (impossible given gauge content).","indep":"From capacity budget alone.","unit":"near-saturation residual"},{"cat":"Consistency","q":"Boson-multiplet identity","sym":"N_gauge+N_Higgs=N_mult","fcf":"12+4=16","obs":"16","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Cross-check","thm":"T12E","adm":"The dark matter DOF count equals the boson sector count. Not coincidence \u2014 enforcement references = gauge + Higgs.","falsify":"Would fail if N_mult \u2260 16.","indep":"Algebraic identity connecting gauge and dark sectors.","unit":"ledger balance identity"},{"cat":"Consistency","q":"Generation consistency","sym":"N\u00b2+6=5N","fcf":"9+6=15=5\u00d73","obs":"\u2014","err":0,"errS":"exact","epi":"P","regime":"\u2014","sector":"Algebraic","thm":"T4F","adm":"Capacity saturation condition. Only N=3 satisfies this as a positive integer.","falsify":"Would fail if N_gen \u2260 3 (but N_gen is already derived).","indep":"Internal consistency check.","unit":"capacity budget check"},{"cat":"Couplings","q":"\u03b1(M_Z)","sym":"1/127.9","fcf":"\u22481/128","obs":"1/127.95","err":0.04,"errS":"~0.04%","epi":"C_import","regime":"RG running","sector":"EW (T6)","thm":"T6+T6B","adm":"RG running from capacity fixed point. \u03b2-coefficients imported from QFT (experimentally confirmed).","falsify":"If running deviated from 1-loop prediction (would indicate new physics at intermediate scale).","indep":"Uses imported \u03b2-functions. Structural form from FCF, coefficients from QFT.","unit":"capacity measure"},{"cat":"Couplings","q":"\u03b1_s(M_Z)","sym":"\u22480.118","fcf":"0.118","obs":"0.1179","err":0.08,"errS":"~0.08%","epi":"C_import","regime":"RG running","sector":"QCD (T6)","thm":"T6+T6B","adm":"QCD coupling at Z mass from RG running. Import-gated: \u03b2-coefficients from perturbative QCD.","falsify":"Deviation from perturbative running would signal confinement-scale new physics.","indep":"Independent sector from EW.","unit":"capacity measure"},{"cat":"Testable","q":"Neutrino mass type","sym":"Majorana","fcf":"Majorana","obs":"TBD","err":"\u2014","errS":"TBD","epi":"testable","regime":"C=61 vs C=64","sector":"Neutrino","thm":"T12E","adm":"C_total=61 (no \u03bd_R) matches Planck 1\u03c3. C=64 (Dirac) gives 2.5\u03c3 tension.","falsify":"Non-detection of 0\u03bd\u03b2\u03b2 at full LEGEND/nEXO/CUPID sensitivity.","indep":"Capacity argument. Independent of all other predictions.","unit":"capacity parity (C = 61)"},{"cat":"Testable","q":"No WIMP detection","sym":"null","fcf":"null","obs":"consistent","err":"\u2014","errS":"\u2014","epi":"testable","regime":"R12","sector":"Dark matter","thm":"T12","adm":"DM = enforcement overhead, not a particle. No production cross-section with SM fields.","falsify":"Detection of DM particle at direct detection experiments or colliders.","indep":"From DM identification as capacity, not particle.","unit":"unlabeled sector prediction"},{"cat":"Gravity","q":"Gravity = non-factorization","sym":"E_mix \u2260 0","fcf":"derived","obs":"yes","err":0,"errS":"exact","epi":"P_structural","regime":"Any interface with shared enforcement","sector":"Gravity (T7B)","thm":"T7B","adm":"When two subsystems share enforcement load (non-factorizing interface), the external feasibility functional is forced to be quadratic in displacement, local, universal, and endpoint-symmetric. The unique such object is a metric tensor g_\u03bc\u03bd. Gravity is not postulated\u2014it is the bookkeeping cost of shared enforcement.","falsify":"Discovery of a sector that couples to energy-momentum but violates the equivalence principle (non-universal gravity). Or: gravitational shielding of any kind.","indep":"Pure capacity argument from A1+A4. Independent of gauge group, field content, or cosmology.","unit":"shared enforcement cost"},{"cat":"Gravity","q":"Einstein field equations","sym":"G_\u03bc\u03bd+\u039bg_\u03bc\u03bd=\u03baT_\u03bc\u03bd","fcf":"unique in d=4","obs":"confirmed to 10\u207b\u00b9\u2074","err":0,"errS":"exact form","epi":"P","regime":"Continuum limit (\u0393_continuum C\u00b2 metric)","sector":"Gravity (T9_grav)","thm":"T9_grav","adm":"Five admissibility conditions A9.1\u2013A9.5 are each derived from \u0393_geo closure: locality (A3), coordinate invariance (A3 coarse-grain), conservation (\u2207_\u03bcT\u1d5a\u1d64 = 0 from ledger balance), \u22642nd derivatives (\u0393_fbc C\u00b2 bound), wave propagation (A4 causal records). Lovelock\u2019s theorem then uniquely selects the Einstein tensor + \u039b. This is a mathematical theorem\u2014not a physical assumption.","falsify":"Confirmed deviation from GR at any scale: f(R) gravity, massive graviton, Lorentz violation. Current bounds: Cassini 2003 (PPN \u03b3\u22121 < 2.3\u00d710\u207b\u2075), LIGO graviton mass < 1.76\u00d710\u207b\u00b2\u00b3 eV.","indep":"Lovelock is a mathematical theorem (1971). FCF\u2019s contribution: deriving A9.1\u2013A9.5 from axioms + d=4 from T8.","unit":"unique admissible response"},{"cat":"Gravity","q":"Graviton: massless spin-2","sym":"m=0, s=2, 2 DOF","fcf":"derived","obs":"consistent (LIGO)","err":0,"errS":"exact","epi":"P","regime":"Linearized around Minkowski","sector":"Gravity (T9_grav+T8)","thm":"T9_grav+T8","adm":"\u03b4g_\u03bc\u03bd has 10 components (symmetric 4\u00d74). Bianchi identity removes 4 (conservation). Diffeomorphism gauge removes 4 more. Remaining: 2 physical transverse-traceless DOF = massless spin-2. Mass forbidden by gauge invariance (Boulware-Deser ghost in massive case).","falsify":"Detection of massive graviton: m_g > 0 gives 5 DOF + Boulware-Deser ghost. Current bound: m_g < 1.76\u00d710\u207b\u00b2\u00b3 eV (LIGO O3). Or: detection of scalar/vector GW polarizations (spin \u2260 2).","indep":"Standard linearized GR. FCF derives the metric (T7B) and d=4 (T8) from which this follows.","unit":"gauge-reduced tensor DOF"},{"cat":"Gravity","q":"Gravitational wave polarizations","sym":"h_+, h_\u00d7","fcf":"exactly 2","obs":"2 (LIGO/Virgo)","err":0,"errS":"exact","epi":"P","regime":"d=4 Lorentzian, massless","sector":"Gravity (T8+T9_grav)","thm":"T8+T9_grav","adm":"Massless little group in d dimensions is SO(d\u22122). In d=4: SO(2), helicity \u00b12. In d=3: SO(1) \u2192 0 DOF (topological). In d=5: SO(3) \u2192 5 DOF. Only d=4 gives exactly 2 propagating polarizations compatible with A4 records.","falsify":"Detection of additional GW polarization modes (breathing, longitudinal, vector). Current LIGO+Virgo+KAGRA analyses constrain non-tensorial polarizations to <10% amplitude (GW170814).","indep":"From d=4 (T8) + massless representation theory. Changes if d\u22604 or m_graviton > 0.","unit":"little group irrep"},{"cat":"Gravity","q":"\u03ba ~ 1/C_*","sym":"G ~ \u210fc/C_*","fcf":"scaling law","obs":"G measured","err":"\u2014","errS":"structural scaling","epi":"P_structural","regime":"Capacity\u2192curvature conversion","sector":"Gravity (T10)","thm":"T10","adm":"T_\u03bc\u03bd measures irreversibly committed internal enforcement load. Curvature measures spatial variation of external feasibility. Conversion: \u03ba must have dimensions [capacity]\u207b\u00b9, so \u03ba ~ 1/C_* where C_* is the A1 bound. The O(1) prefactor requires UV completion.","falsify":"If gravitational coupling did not scale inversely with any capacity-like quantity. Equivalently: if adding capacity to a system did not weaken its gravitational self-interaction.","indep":"From T7B (gravity = non-factorization) + dimensional analysis on capacity. Independent of gauge or matter.","unit":"inverse capacity scale"},{"cat":"Gravity","q":"\u039b > 0 structural mechanism","sym":"C_vac/C_total residual","fcf":"positive, small","obs":"positive, small","err":0,"errS":"sign + smallness","epi":"P_structural","regime":"R11 (horizon saturation)","sector":"Vacuum ledger (T11)","thm":"T11","adm":"After all enforcement commitments (45 Weyl + 4 Higgs + 12 gauge = 61 DOF budget), 42 unlabeled vacuum entries remain. Residual is positive (C_total > C_committed) and small (absolute density suppressed by 1/C_*\u00b2). Explains the 120-order-of-magnitude fine-tuning: not tuned, it is an integer ratio divided by a huge capacity scale.","falsify":"Evidence for quintessence (time-varying \u039b) or \u039b < 0 (AdS universe). Current: \u039b constant to ~2% (DES+Planck). Also: 42/61 disagreeing with \u03a9_\u039b by >3\u03c3.","indep":"From capacity budget (T3+T11). Independent of matter sector counting.","unit":"capacity residual density"},{"cat":"Quantum Gravity","q":"Quantum EFE (structural sketch)","sym":"operator equation","fcf":"sketch","obs":"no data","err":"\u2014","errS":"open","epi":"open","regime":"Full quantum gravity","sector":"Quantum gravity (T1+T2+T9)","thm":"T1+T2+T9_grav","adm":"Aspiration: promote classical EFE to operator equation on Type III\u2081 von Neumann algebra via GNS. Modular flow = time. Semi-classical recovers classical EFE. HOWEVER: modular variation \u03b4S/\u03b4A not rigorously defined; g_\u03bc\u03bd promotion aspirational; Dirac operator D not constructed. Research direction, not theorem.","falsify":"N/A\u2014not yet a sharp prediction.","indep":"Requires full T1/T2 integration with gravity. Main open frontier.","unit":"operator-valued constraint"},{"cat":"Quantum Gravity","q":"Modular time (Tomita-Takesaki)","sym":"\u03c3_t(A)=\u0394^{it}A\u0394^{-it}","fcf":"theorem","obs":"\u2014","err":"\u2014","errS":"mathematical","epi":"P","regime":"Type III\u2081 von Neumann algebra","sector":"Quantum algebra (T2+A4)","thm":"T2+A4","adm":"Tomita-Takesaki theorem (1970): for any faithful normal state \u03c9 on a von Neumann algebra A, there exists a unique modular automorphism group \u03c3_t. A4 forces KMS condition; A2 forces Type III\u2081. The modular flow is canonical time evolution without external parameter. Rigorous mathematical result applied to admissibility.","falsify":"If time evolution in quantum gravity required an external background structure not derivable from algebraic state. Connes\u2019 thermal time hypothesis (1994) makes the same structural claim.","indep":"Mathematical theorem (Tomita 1967, Takesaki 1970). FCF identifies the physical context.","unit":"automorphism flow"},{"cat":"TOE Gap","q":"Higgs mass m_H","sym":"125.25 GeV","fcf":"bounded","obs":"125.25\u00b10.17","err":"\u2014","errS":"bounded","epi":"open","regime":"EW+gravity","sector":"Higgs (T10)","thm":"T10","adm":"Structural: vacuum stability gives m_H near metastability boundary. Absolute value needs \u03ba (T10).","falsify":"N/A \u2014 not yet a sharp prediction.","indep":"Requires gravity sector (T10) for absolute scale.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Top quark mass m_t","sym":"172.76 GeV","fcf":"hierarchy derived","obs":"172.76\u00b10.30","err":"\u2014","errS":"bounded","epi":"open","regime":"Yukawa","sector":"Yukawa (T4G)","thm":"T4G","adm":"Yukawa hierarchy structure derived (near-diagonal CKM, mass ratios scale with capacity cost). Absolute scale open.","falsify":"N/A \u2014 not yet sharp.","indep":"Requires T4G completion.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Electron mass m_e","sym":"0.511 MeV","fcf":"\u2014","obs":"0.511 MeV","err":"\u2014","errS":"open","epi":"open","regime":"Yukawa","sector":"Yukawa (T4G)","thm":"T4G","adm":"Lightest charged lepton. Mass value requires Yukawa structure completion.","falsify":"N/A.","indep":"Part of Yukawa sector.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Muon mass m_\u03bc","sym":"105.66 MeV","fcf":"\u2014","obs":"105.66 MeV","err":"\u2014","errS":"open","epi":"open","regime":"Yukawa","sector":"Yukawa","thm":"T4G","adm":"2nd-gen lepton. Ratio m_\u03bc/m_e \u2248 207 from Yukawa hierarchy, not yet derived.","falsify":"N/A.","indep":"Part of Yukawa sector.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Tau mass m_\u03c4","sym":"1776.86 MeV","fcf":"\u2014","obs":"1776.86 MeV","err":"\u2014","errS":"open","epi":"open","regime":"Yukawa","sector":"Yukawa","thm":"T4G","adm":"3rd-gen lepton.","falsify":"N/A.","indep":"Part of Yukawa sector.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Up quark mass m_u","sym":"2.16 MeV","fcf":"\u2014","obs":"2.16 MeV","err":"\u2014","errS":"open","epi":"open","regime":"Yukawa","sector":"Yukawa","thm":"T4G","adm":"Lightest quark.","falsify":"N/A.","indep":"Part of Yukawa sector.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Down quark mass m_d","sym":"4.67 MeV","fcf":"\u2014","obs":"4.67 MeV","err":"\u2014","errS":"open","epi":"open","regime":"Yukawa","sector":"Yukawa","thm":"T4G","adm":"2nd-lightest quark.","falsify":"N/A.","indep":"Part of Yukawa sector.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"CKM matrix","sym":"near-diagonal","fcf":"hierarchy","obs":"measured","err":"\u2014","errS":"structural","epi":"open","regime":"Yukawa","sector":"Yukawa (T4G)","thm":"T4G","adm":"Capacity cost minimization \u2192 V_CKM \u2248 I. |V_ub|\u226a|V_cb|\u226a|V_us| follows mass hierarchy. Pattern derived, not values.","falsify":"If CKM were far from identity (e.g. maximal mixing in quark sector).","indep":"From Yukawa capacity cost.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"PMNS matrix","sym":"large mixing","fcf":"\u2014","obs":"measured","err":"\u2014","errS":"open","epi":"open","regime":"Neutrino","sector":"Neutrino","thm":"T4G_Q31","adm":"Lepton mixing. Near-degenerate neutrino masses \u2192 large mixing is cheap. Not yet quantitative.","falsify":"N/A.","indep":"Part of neutrino sector.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Neutrino masses","sym":"\u03a3m_\u03bd < 0.12 eV","fcf":"bounded","obs":"<0.12 eV","err":"\u2014","errS":"bounded","epi":"open","regime":"Neutrino","sector":"Neutrino (T4G_Q31)","thm":"T4G_Q31","adm":"Upper bound from capacity: m_\u03bd \u2264 C_int\u00b7(\u03b5_\u03bd/\u03b5_t). Correct order of magnitude.","falsify":"If neutrino masses were above the capacity bound.","indep":"Requires T4G completion.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"CP violation \u03b4_CKM","sym":"~1.2 rad","fcf":"\u2014","obs":"1.196\u00b10.045","err":"\u2014","errS":"open","epi":"open","regime":"CP","sector":"Yukawa","thm":"\u2014","adm":"CP phase. FCF derives that CP violation must exist (A4 \u2192 arrow of time) but not the angle.","falsify":"N/A.","indep":"Requires CP sector completion.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Strong CP \u03b8_QCD","sym":"<10\u207b\u00b9\u2070","fcf":"\u2014","obs":"<10\u207b\u00b9\u2070","err":"\u2014","errS":"open","epi":"open","regime":"QCD","sector":"QCD vacuum","thm":"\u2014","adm":"Strong CP problem. FCF has not yet addressed why \u03b8_QCD \u2248 0.","falsify":"N/A.","indep":"Open problem.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"Planck mass M_P","sym":"1.22\u00d710\u00b9\u2079 GeV","fcf":"\u2014","obs":"measured","err":"\u2014","errS":"open","epi":"open","regime":"Gravity","sector":"Gravity (T10)","thm":"T10","adm":"Absolute gravity scale. Requires \u03ba (Newton's constant) from T10. Currently the main open gap.","falsify":"N/A.","indep":"Requires T10 completion.","unit":"open \u2014 not yet derived"},{"cat":"TOE Gap","q":"QCD scale \u039b_QCD","sym":"~220 MeV","fcf":"\u2014","obs":"~220 MeV","err":"\u2014","errS":"open","epi":"open","regime":"RG","sector":"QCD","thm":"T6","adm":"Confinement scale. RG running from capacity fixed point could predict this, but requires absolute scale.","falsify":"N/A.","indep":"Part of absolute scale problem.","unit":"open \u2014 not yet derived"}];

var TC=['#818cf8','#a78bfa','#f472b6','#fbbf24','#60a5fa','#34d399'];
var AC='#f87171';
var TN={'-1':'Axioms',0:'Axiom Foundations',1:'Gauge Group',2:'Particles',3:'RG / Constants',4:'Gravity + Dark',5:'\u0393_geo Closure'};
var AXNM={A1:'Finite Capacity',A2:'Non-Closure',A3:'Locality',A4:'Irreversibility',A5:'Minimality'};
var EPI_COLORS={'P':['var(--grn)','var(--grng)'],'P_structural':['var(--blu)','var(--blug)'],'C_import':['var(--amb)','var(--ambg)'],'testable':['var(--pur)','var(--purg)'],'open':['var(--dm)','var(--bg)']};

function esc(s){return s?String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'):''}
function toggleCard(el){el.classList.toggle('open')}
function switchTab(panel,tab){
  panel.querySelectorAll('.bp-tab').forEach(function(t){t.classList.remove('active')});
  panel.querySelectorAll('.bp-panel').forEach(function(p){p.classList.remove('active')});
  tab.classList.add('active');
  panel.querySelector('#'+tab.dataset.panel).classList.add('active');
}
function toggleXR(el){var row=el.closest('.xr');if(row)row.classList.toggle('open')}
function toggleToe(el){el.classList.toggle('open')}

function main(){
  var d=D;if(!d){document.getElementById('app').innerHTML='<div class="loading" style="color:var(--red)">Failed</div>';return}
  render(d);
}

function render(d){
  var ep=d.epistemic_counts||{},pC=ep.P||0,pPct=Math.round(pC/d.total_theorems*100);
  var preds=d.predictions||[];
  var openCount=0;
  Object.values(d.theorems||{}).forEach(function(t){if(t.gap_type==='open_physics')openCount++});
  var tiers=d.tier_stats||{};
  var tierThms={};
  Object.entries(d.theorems||{}).forEach(function(e){var id=e[0],t=e[1];var tier=t.tier||0;if(!tierThms[tier])tierThms[tier]=[];tierThms[tier].push(Object.assign({id:id},t))});

  var h=[];

  //  HEADER + INTRO 
  h.push('<div class="hdr"><div class="hdr-tag">Admissibility Physics Engine</div>');
  h.push('<div class="hdr-t">'+(d.version||'v3.6')+' \u2014 Foundational Constraint Framework</div>');
  h.push('<div class="hdr-s">Last updated: '+d.date+' at 9:57 PM Pacific \u00b7 <b>'+d.total_theorems+' theorems</b> \u00b7 5 axioms \u00b7 0 free parameters \u00b7 <b>'+preds.length+' predictions</b></div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);margin-top:6px">Developed by <a href=\"https://www.linkedin.com/in/ethanbrooke/\" style=\"color:var(--grn);text-decoration:underline\">Ethan S. Brooke</a> \u00b7 <a href=\"https://zenodo.org/communities/admissibility_physics/records?q=&l=list&p=1&s=10&sort=newest\" style=\"color:var(--blu);text-decoration:underline\">Preprint Archive</a> \u00b7 <a href=\"https://github.com/Ethan-Brooke/Admissibility-Physics-Engine-v3.6\" style=\"color:var(--pur);text-decoration:underline\">GitHub Repository</a></div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.7;margin-top:14px;max-width:760px">This dashboard is the live output of the <b style="color:var(--br)">Admissibility Physics Engine</b>\u2014a computational framework that derives the structure of known physics from five information-theoretic axioms (A1\u2013A5) with zero free parameters. Every constant, particle, and force shown below is either <em>derived</em> from these axioms or explicitly marked as an open gap. The framework does not fit data: it outputs rational numbers from constraint logic and then compares them to experiment. Scroll down to see the complete constants map, the cosmic energy budget, particle and gravity derivations, and interactive theorem visualizations. <a href=\'https://github.com/ethan-brooke/Admissibility-Physics-Engine-v3.6\' style=\'color:var(--grn);text-decoration:underline\'>Run the engine yourself on GitHub \u2192</a></div>');
  h.push('</div>');

// Compute epiCount from TOE (needed by multiple sections below)
  var epiCount={P:0,P_structural:0,C_import:0,testable:0,open:0};
  TOE.forEach(function(c){epiCount[c.epi]=(epiCount[c.epi]||0)+1});

  //  PAPERS 
  h.push('<div class="sec"><div class="sec-t">Papers</div>');
  h.push('<div class="sec-intro">The full technical framework, hosted on <a href="https://zenodo.org/communities/admissibility_physics/records?q=&l=list&p=1&s=10&sort=newest" style="color:var(--blu);text-decoration:underline">Zenodo</a>. Read in order for the derivation chain, or start with Paper 13 for a self-contained summary of the foundational layer.</div>');
  h.push('<div class="card" style="padding:0;overflow:hidden">');

  var papers=[
    {n:'Paper\u200a1',t:'The Enforceability of Distinction',tag:'SPINE',url:'https://zenodo.org/records/18528946',
     desc:'Establishes the foundational principle: physical meaning requires finite enforcement. Derives non-closure, irreversibility, and temporal ordering from a single axiom\u2014no dynamics, probability, or geometry assumed.'},
    {n:'Paper\u200a2',t:'Finite Admissibility and the Failure of Global Description',tag:'STRUCTURE',url:'https://zenodo.org/records/18528992',
     desc:'Proves that admissible sets do not compose freely: global descriptions fail generically under finite capacity. Introduces the structural constraints that govern all subsequent derivations.'},
    {n:'Paper\u200a3',t:'Entropy, Time, and Accumulated Cost',tag:'LEDGERS',url:'https://zenodo.org/records/18528995',
     desc:'Defines entropy as committed correlation capacity\u2014prior to probability or statistical mechanics. Derives irreversibility and the arrow of time as structural consequences of enforcement accumulation.'},
    {n:'Paper\u200a4',t:'Admissibility Constraints and Structural Saturation',tag:'CONSTRAINTS',url:'https://zenodo.org/records/18528999',
     desc:'Derives monogamy bounds, area laws, and cut-set limits from finite enforceability. Characterizes saturation and horizons as regime boundaries where enforcement capacity is exhausted.'},
    {n:'Paper\u200a5',t:'Quantum Structure from Finite Enforceability',tag:'QUANTUM',url:'https://zenodo.org/records/18529002',
     desc:'Derives Hilbert space, the Born rule, and unitarity from the constraint structure. Explains measurement as a regime transition, not a dynamical mystery\u2014quantum mechanics emerges rather than being assumed.'},
    {n:'Paper\u200a6',t:'Dynamics and Geometry as Optimal Admissible Reallocation',tag:'GEOMETRY',url:'https://zenodo.org/records/18529005',
     desc:'Derives action principles, geodesics, and the Einstein field equations from enforcement cost extremization. General relativity emerges as optimal capacity reallocation; singularities and horizons are predicted regime exits.'},
    {n:'Paper\u200a7',t:'A Minimal Quantum of Action from Finite Admissibility',tag:'ACTION',url:'https://zenodo.org/records/18529009',
     desc:'Proves that zero action is structurally excluded for record-forming transitions. The existence of a minimum action scale (connected to \u210f) is derived, not postulated\u2014it follows from finite enforceability.'},
    {n:'Paper\u200a13',t:'The Minimal Admissibility Core',tag:'CORE v4.0',url:'https://zenodo.org/records/18445266',
     desc:'Self-contained summary of the foundational layer. Closes the pre-physical axiom set and proves that all subsequent derivations (quantum mechanics, gravity, cosmology) require no additional assumptions beyond A1\u2013A5.'}
  ];

  papers.forEach(function(p,i){
    var bdr=i<papers.length-1?'border-bottom:1px solid var(--bdr);':'';
    h.push('<a href="'+p.url+'" target="_blank" rel="noopener" style="display:grid;grid-template-columns:90px 1fr;gap:0;padding:12px 16px;'+bdr+'text-decoration:none;transition:background .15s;cursor:pointer" onmouseover="this.style.background=\\'var(--blug)\\'" onmouseout="this.style.background=\\'transparent\\'">');
    h.push('<div style="font-family:var(--mn)"><div style="font-size:13px;font-weight:700;color:var(--br)">'+p.n+'</div><div style="font-size:10px;color:var(--pur);letter-spacing:1px;margin-top:2px">'+p.tag+'</div></div>');
    h.push('<div><div style="font-family:var(--sn);font-size:14px;font-weight:600;color:var(--br);line-height:1.3">'+p.t+'</div><div style="font-family:var(--mn);font-size:12px;color:var(--dm);margin-top:3px;line-height:1.5">'+p.desc+'</div></div>');
    h.push('</a>');
  });

  h.push('</div></div>');

  //  EPISTEMIC KEY 
  h.push('<div class="sec"><div class="sec-t">Epistemic Status Key</div>');
  h.push('<div class="sec-intro">Every result in this framework carries an epistemic badge indicating how it was derived and how confident we are in it. This key explains the color-coded system used throughout the dashboard.</div>');
  h.push('<div class="card" style="padding:16px">');
  h.push('<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;font-family:var(--mn);font-size:12px">');
  // P
  h.push('<div style="background:var(--grng);border-radius:6px;padding:12px;border:1px solid rgba(52,211,153,.15)"><div style="display:flex;align-items:center;gap:6px;margin-bottom:6px"><div style="width:10px;height:10px;border-radius:50%;background:var(--grn)"></div><b style="color:var(--grn);font-size:12px">Proven [P]</b></div><div style="color:var(--dm)">Derived exactly from axioms A1\u2013A5 via a complete proof chain. Zero adjustable parameters. These results are as certain as the axioms themselves.</div></div>');
  // P_structural
  h.push('<div style="background:var(--blug);border-radius:6px;padding:12px;border:1px solid rgba(96,165,250,.15)"><div style="display:flex;align-items:center;gap:6px;margin-bottom:6px"><div style="width:10px;height:10px;border-radius:50%;background:var(--blu)"></div><b style="color:var(--blu);font-size:12px">Structural [P_s]</b></div><div style="color:var(--dm)">Derived from axioms but conditional on a regime (e.g. continuum limit, SM matter content). The structure is proved; validity depends on the regime holding.</div></div>');
  // C_import
  h.push('<div style="background:var(--ambg);border-radius:6px;padding:12px;border:1px solid rgba(251,191,36,.15)"><div style="display:flex;align-items:center;gap:6px;margin-bottom:6px"><div style="width:10px;height:10px;border-radius:50%;background:var(--amb)"></div><b style="color:var(--amb);font-size:12px">Import-Gated [C]</b></div><div style="color:var(--dm)">Uses an external input (e.g. QFT \u03b2-function coefficients) that is not derived from A1\u2013A5. The framework logic is sound; the imported value could in principle be wrong.</div></div>');
  // Testable
  h.push('<div style="background:var(--purg);border-radius:6px;padding:12px;border:1px solid rgba(167,139,250,.15)"><div style="display:flex;align-items:center;gap:6px;margin-bottom:6px"><div style="width:10px;height:10px;border-radius:50%;background:var(--pur)"></div><b style="color:var(--pur);font-size:12px">Testable</b></div><div style="color:var(--dm)">A prediction that can be confirmed or falsified by experiment. These are the sharpest tests of the framework. If wrong, the axioms or derivation chain must be revised.</div></div>');
  // Open
  h.push('<div style="background:var(--bg);border-radius:6px;padding:12px;border:1px solid var(--bdr)"><div style="display:flex;align-items:center;gap:6px;margin-bottom:6px"><div style="width:10px;height:10px;border-radius:50%;background:var(--dm)"></div><b style="color:var(--dm);font-size:12px">Open Gap</b></div><div style="color:var(--dm)">Not yet derived. These are honest gaps\u2014parameters the framework acknowledges it cannot yet produce from first principles. Each is a research target.</div></div>');
  h.push('</div></div></div>');

//  COMPLETE CONSTANTS MAP 
  h.push('<div class="sec"><div class="sec-t">Complete Constants Map</div>');
  h.push('<div class="sec-intro">Every parameter needed for a complete Theory of Everything, mapped to its admissibility derivation status. Click any row to see the full proof chain, falsifiability condition, and admissibility interpretation. The \u201cAdmissibility Unit\u201d column shows what each quantity measures in the language of enforcement capacity.</div>');
  // Summary bar
  h.push('<div class="toe-summary">');
  h.push('<div class="ts" style="background:var(--grng)"><span style="color:var(--grn);font-weight:700">'+epiCount.P+'</span><span style="color:var(--dm)"> proven</span></div>');
  h.push('<div class="ts" style="background:var(--blug)"><span style="color:var(--blu);font-weight:700">'+epiCount.P_structural+'</span><span style="color:var(--dm)"> structural</span></div>');
  h.push('<div class="ts" style="background:var(--ambg)"><span style="color:var(--amb);font-weight:700">'+epiCount.C_import+'</span><span style="color:var(--dm)"> import-gated</span></div>');
  h.push('<div class="ts" style="background:var(--purg)"><span style="color:var(--pur);font-weight:700">'+epiCount.testable+'</span><span style="color:var(--dm)"> testable</span></div>');
  h.push('<div class="ts" style="background:var(--bg);border:1px solid var(--bdr)"><span style="color:var(--dm);font-weight:700">'+epiCount.open+'</span><span style="color:var(--dm)"> open gaps</span></div>');
  var derived=epiCount.P+epiCount.P_structural+epiCount.C_import;
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);display:flex;align-items:center;margin-left:8px">'+derived+'/'+TOE.length+' derived \u00b7 '+(Math.round(derived/TOE.length*100))+'% of TOE</div>');
  h.push('</div>');
  h.push('<div class="card" style="overflow-x:auto;padding:12px">');
  // Column headers
  h.push('<div class="toe-hdr"><div></div><div>Quantity</div><div>Value</div><div>Measured</div><div>Adm. Unit</div><div>Deviation</div><div>Status</div><div></div></div>');

  var lastCat='';
  TOE.forEach(function(c){
    if(c.cat!==lastCat){
      lastCat=c.cat;
      var catIcon={'Gauge Structure':'\u2699','Spacetime':'\u2b25','Matter Content':'\u2b24','Charges':'\u26a1','Electroweak':'\u2b50','Cosmology':'\ud83c\udf0c','Consistency':'\u2714','Couplings':'\u03b1','Testable':'\ud83d\udd2c','TOE Gap':'\u2753','Gravity':'\ud83c\udf0d','Quantum Gravity':'\u269b'}[c.cat]||'\u25cf';
      h.push('<div class="toe-cat">'+catIcon+' '+c.cat+'</div>');
    }
    var ec=EPI_COLORS[c.epi]||['var(--dm)','var(--bg)'];
    var errDisplay=typeof c.err==='number'?(c.err===0?'exact':c.err.toFixed(2)+'%'):esc(c.errS);
    var errCol=c.err===0?'var(--grn)':typeof c.err==='number'?'var(--blu)':'var(--dm)';
    h.push('<div class="toe-row" onclick="toggleToe(this)">');
    h.push('<div class="xr-dot" style="background:'+ec[0]+'"></div>');
    h.push('<div class="t-q">'+esc(c.q)+'</div>');
    h.push('<div class="t-v">'+esc(c.sym)+'</div>');
    h.push('<div class="t-obs">'+esc(c.obs||'\u2014')+'</div>');
    h.push('<div class="t-u">'+esc(c.unit||'')+'</div>');
    h.push('<div class="t-e" style="color:'+errCol+'">'+errDisplay+'</div>');
    h.push('<div><span class="t-epi" style="background:'+ec[1]+';color:'+ec[0]+'">'+c.epi.replace('P_','')+'</span></div>');
    h.push('<div class="t-arrow">\u25bc</div></div>');
    h.push('<div class="toe-expand"><div class="toe-detail">');
    h.push('<div class="xd-row"><span class="xd-label">Admissibility:</span>'+esc(c.adm)+'</div>');
    if(c.regime&&c.regime!=='\u2014')h.push('<div class="xd-row"><span class="xd-label">Regime:</span><span style="color:var(--amb)">'+esc(c.regime)+'</span></div>');
    h.push('<div class="xd-row"><span class="xd-label">Sector:</span>'+esc(c.sector)+'</div>');
    if(c.indep)h.push('<div class="xd-row"><span class="xd-label">Independence:</span>'+esc(c.indep)+'</div>');
    h.push('<div class="xd-row"><span class="xd-label">Theorem:</span>'+esc(c.thm)+'</div>');
    if(c.falsify&&c.falsify!=='N/A.'&&c.falsify!=='N/A')h.push('<div class="xd-row"><span class="xd-label" style="color:var(--red)">Falsifiable:</span><span style="color:var(--red)">'+esc(c.falsify)+'</span></div>');
    
  // Gauge group derivation chain
  h.push('<div style="margin-top:20px;font-size:14px;font-weight:700;color:var(--br);padding-top:12px;border-top:1px solid var(--bdr)">Gauge Group: Why $SU(3) \\times SU(2) \\times U(1)$</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin:8px 0">The gauge group is not assumed\u2014it is selected by solving anomaly cancellation exactly and then minimizing capacity cost.</div>');
  h.push('<div style="padding:8px 12px;background:var(--bg);border:1px solid var(--bdr);border-radius:6px;margin-bottom:8px;font-size:13px;line-height:2">');
  h.push('<div style="color:var(--br);font-weight:600;margin-bottom:4px">Step 1: Anomaly equation (solved, not assumed)</div>');
  h.push('<div style="color:var(--pur)">$[U(1)]^3 = 0 \\;\\Rightarrow\\; z^2 - 2z - (N_c^2 - 1) = 0, \\quad z = Y_u/Y_Q$</div>');
  h.push('<div style="color:var(--dm);font-size:11px">Discriminant $= 4N_c^2 \\;\\Rightarrow\\; z = 1 \\pm N_c$ (exact rational roots for all $N_c$)</div>');
  h.push('<div style="color:var(--br);font-weight:600;margin-top:6px">Step 2: Filter by physics constraints</div>');
  h.push('<div style="color:var(--dm);font-size:11px">Confinement ($N_c \\geq 2$) \\u2714 \\u00b7 Witten anomaly ($N_c$ odd) \\u2714 \\u00b7 Chirality ($z \\neq 1$) \\u2714</div>');
  h.push('<div style="color:var(--br);font-weight:600;margin-top:6px">Step 3: Capacity optimization (A1)</div>');
  h.push('<div style="color:var(--grn)">$\\dim(G) = (N_c^2 - 1) + 3 + 1 \\quad\\Rightarrow\\quad N_c = 3: \\; \\dim = 12 \\;\\;\\checkmark \\quad N_c = 5: \\; \\dim = 28 \\;\\; \\text{(excluded by A5)}$</div>');
  h.push('</div>');

  // Generation count derivation
  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-top:16px">Why Exactly 3 Generations</div>');
  h.push('<div style="padding:8px 12px;background:var(--bg);border:1px solid var(--bdr);border-radius:6px;margin:8px 0;font-size:13px;line-height:2">');
  h.push('<div style="color:var(--pur)">$E(N) = \\frac{N(N+1)}{2}\\,\\varepsilon \\quad\\text{(cost of } N \\text{ generations in EW capacity)}$</div>');
  h.push('<div style="color:var(--dm);font-size:11px;margin:4px 0">EW capacity: $C_{\\rm EW} = \\kappa \\cdot d = 2 \\times 4 = 8\\varepsilon$ (from T_\\kappa and T_channels)</div>');
  h.push('<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:8px 0;text-align:center">');
  [{n:1,e:1,ok:true},{n:2,e:3,ok:true},{n:3,e:6,ok:true},{n:4,e:10,ok:false}].forEach(function(g){
    h.push('<div style="padding:8px;border-radius:5px;border:1px solid '+(g.ok?'var(--grn)':'var(--red)')+';background:'+(g.ok?'var(--grng)':'rgba(248,113,113,.08)')+'"><div style="font-size:16px;font-weight:700;color:'+(g.ok?'var(--grn)':'var(--red)')+'">$N = '+g.n+'$</div><div style="font-size:11px;color:var(--dm)">$E = '+g.e+(g.ok?' \\leq 8$':' > 8$')+'</div><div style="font-size:10px;color:'+(g.ok?'var(--grn)':'var(--red)')+'">'+(g.ok?'\\u2714 fits':'\\u2718 overflow')+'</div></div>');
  });
  h.push('</div>');
  h.push('<div style="color:var(--grn);font-weight:600;text-align:center">$E(3) = 6 \\leq 8 < 10 = E(4) \\quad\\Rightarrow\\quad N_{\\rm gen} = 3$ exactly</div>');
  h.push('</div>');

  // sin_W derivation
  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-top:16px">$\\sin^2\\theta_W = 3/13$: Full Derivation Chain</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin:6px 0">Five steps, no free parameters. Each feeds into the next.</div>');
  h.push('<div style="padding:8px 12px;background:var(--bg);border:1px solid var(--bdr);border-radius:6px;margin:8px 0;font-size:13px;line-height:2">');
  h.push('<div><span style="color:var(--blu);font-weight:600">T27c:</span> Interface schema invariance $\\Rightarrow\\; x = 1/2$</div>');
  h.push('<div><span style="color:var(--blu);font-weight:600">T27d:</span> $\\Gamma_{\\rm geo}$ closure $\\Rightarrow\\; \\gamma_2/\\gamma_1 = d + 1/d = 4 + 1/4 = 17/4$</div>');
  h.push('<div><span style="color:var(--blu);font-weight:600">T22:</span> Competition matrix: $a_{11} = 1,\\; a_{12} = x = 1/2,\\; a_{22} = x^2 + 3 = 13/4$</div>');
  h.push('<div><span style="color:var(--blu);font-weight:600">T23:</span> Fixed point: $r^* = \\frac{\\gamma_1 a_{22} - \\gamma_2 a_{12}}{\\gamma_2 a_{11} - \\gamma_1 a_{12}} = \\frac{1 \\cdot 13/4 - 17/4 \\cdot 1/2}{17/4 \\cdot 1 - 1 \\cdot 1/2} = \\frac{9/8}{30/8} = \\frac{3}{10}$</div>');
  h.push('<div style="margin-top:4px"><span style="color:var(--grn);font-weight:700;font-size:15px">T24:</span> <span style="color:var(--grn);font-size:15px">$\\sin^2\\theta_W = \\frac{r^*}{1 + r^*} = \\frac{3/10}{13/10} = \\frac{3}{13} \\approx 0.23077$</span></div>');
  h.push('<div style="font-size:11px;color:var(--dm);margin-top:2px">Experiment: $0.23122 \\pm 0.00003$ \\u00b7 Deviation: <span style="color:var(--grn)">0.19%</span></div>');
  h.push('</div>');

h.push('</div></div>');
  });
  h.push('</div></div>');

//  COSMIC ENERGY BUDGET 
  h.push('<div class="sec"><div class="sec-t">Cosmic Energy Budget</div>');
  h.push('<div class="sec-intro">The total energy content of the universe, decomposed by the capacity ledger. Every fraction shown here is a ratio of small integers derived from the axiomsnot a fit to CMB data. The comparison with Planck 2018 measurements is a post-hoc check.</div>');
  h.push('<div class="bp" id="budget-panel">');
  h.push('<div class="bp-hdr"><div class="bp-tag">Theorem 11 + 12E \u00b7 Admissibility Physics v3.6</div>');
  h.push('<div class="bp-title">Cosmic Energy Budget<br>from <em>Capacity Accounting</em></div>');
  h.push('<div class="bp-sub">Dark matter, dark energy, and baryonic matter derived from gauge overhead,<br>infrastructure cost, and ledger partition. No tunable microphysics.</div></div>');
  h.push('<div class="bp-quote">\u201cDark matter is what you get when you don\u2019t pay the <em>gauge toll</em>.\u201d</div>');
  h.push('<div class="bp-stats">');
  h.push('<div class="bp-stat"><div class="bp-stat-l">C_total</div><div class="bp-stat-v" style="color:var(--grn)">61</div><div class="bp-stat-s">DOF budget</div></div>');
  h.push('<div class="bp-stat"><div class="bp-stat-l">Observed</div><div class="bp-stat-v" style="color:var(--br)">5.33</div><div class="bp-stat-s">DM/baryon</div></div>');
  h.push('<div class="bp-stat"><div class="bp-stat-l">Mean Error</div><div class="bp-stat-v" style="color:var(--grn)">0.33%</div><div class="bp-stat-s">5 params</div></div>');
  h.push('<div class="bp-stat"><div class="bp-stat-l">Free Params</div><div class="bp-stat-v" style="color:var(--pur)">0</div><div class="bp-stat-s">no tuning</div></div>');
  h.push('<div class="bp-stat"><div class="bp-stat-l">Planck</div><div class="bp-stat-v" style="color:var(--grn)">5/5</div><div class="bp-stat-s">within 1\u03c3</div></div>');
  h.push('</div>');

  // Budget tabs
  var tabNames=['Budget','DOF Breakdown','Planck Data','Dark Matter','Majorana Test','Not a Fit','Falsifiability'];
  h.push('<div class="bp-tabs">');
  tabNames.forEach(function(t,i){h.push('<div class="bp-tab'+(i===0?' active':'')+'" data-panel="bp-p'+i+'" onclick="switchTab(document.getElementById(\'budget-panel\'),this)">'+t+'</div>')});
  h.push('</div>');

  // Panel 0: Budget donut + expandable rows
  h.push('<div class="bp-panel active" id="bp-p0">');
  h.push('<div class="donut-wrap"><canvas id="donut-canvas" width="180" height="180" style="width:180px;height:180px"></canvas>');
  h.push('<div class="donut-legend">');
  var sects=[{n:'Dark Energy (\u039b)',tag:'T11',tc:'var(--pur)',desc:'Globally locked capacity residual',pct:'68.9%',c:'#a78bfa'},{n:'Dark Matter',tag:'T12',tc:'var(--blu)',desc:'Gauge-singlet committed capacity',pct:'25.9%',c:'#60a5fa'},{n:'Baryonic Matter',tag:'T3+T4E',tc:'var(--grn)',desc:'Gauge-charged committed capacity',pct:'4.9%',c:'#34d399'}];
  sects.forEach(function(s){h.push('<div class="dl-row"><div class="dl-dot" style="background:'+s.c+'"></div><div class="dl-info"><span class="dl-name">'+s.n+'</span><span class="dl-tag" style="background:'+s.tc+'20;color:'+s.tc+'">'+s.tag+'</span><div class="dl-desc">'+s.desc+'</div></div><div class="dl-pct" style="color:'+s.c+'">'+s.pct+'</div></div>')});
  h.push('</div></div>');

  // Expandable budget rows
  var brows=TOE.filter(function(c){return c.cat==='Cosmology'&&typeof c.err==='number'&&c.err>0});
  var bcolors={'\u03a9_\u039b':'#a78bfa','\u03a9_m':'#60a5fa','\u03a9_b':'#34d399','\u03a9_DM':'#818cf8','f_b':'#f472b6'};
  brows.forEach(function(r){if(!r.col)r.col=bcolors[r.q]||'#888'});
  h.push('<div style="margin-top:14px">');
  brows.forEach(function(r){
    var ec=EPI_COLORS[r.epi]||['var(--dm)','var(--bg)'];
    h.push('<div class="xr" onclick="toggleXR(event.target)"><div class="xr-top">');
    h.push('<div class="xr-dot" style="background:'+r.col+'"></div>');
    h.push('<div class="xr-q">'+esc(r.q)+' = '+esc(r.sym)+'</div>');
    h.push('<div class="xr-val">'+esc(r.fcf)+'</div>');
    h.push('<div class="xr-err" style="color:'+r.col+'">'+r.err.toFixed(2)+'%</div>');
    h.push('<div><span class="xr-badge" style="background:'+ec[1]+';color:'+ec[0]+'">'+r.epi.replace('P_','')+'</span></div>');
    h.push('<div class="xr-arrow">\u25bc</div></div>');
    h.push('<div class="xr-expand"><div class="xr-detail">');
    h.push('<div class="xd-row"><span class="xd-label">Admissibility:</span>'+esc(r.adm)+'</div>');
    h.push('<div class="xd-row"><span class="xd-label">Regime:</span><span style="color:var(--amb)">'+esc(r.regime)+'</span></div>');
    h.push('<div class="xd-row"><span class="xd-label">Sector:</span>'+esc(r.sector)+'</div>');
    h.push('<div class="xd-row"><span class="xd-label">Independence:</span>'+esc(r.indep)+'</div>');
    h.push('<div class="xd-row"><span class="xd-label">Proof chain:</span>'+esc(r.thm)+'</div>');
    h.push('<div class="xd-row"><span class="xd-label" style="color:var(--red)">Falsifiable by:</span><span style="color:var(--red)">'+esc(r.falsify)+'</span></div>');
    h.push('<div class="xd-row"><span class="xd-label">Error method:</span>|derived \u2212 observed| / observed, Planck 2018 \u039bCDM flat central values</div>');
    h.push('</div></div></div>');
  });
  h.push('</div></div>');

  // Panel 1: DOF Breakdown
  h.push('<div class="bp-panel" id="bp-p1"><div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.9">');
  h.push('<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:14px">');
  [{n:45,l:'Weyl fermions',s:'15/gen \u00d7 3',c:'var(--pur)'},{n:4,l:'Higgs DOF',s:'complex doublet',c:'var(--blu)'},{n:12,l:'Gauge generators',s:'8+3+1',c:'var(--amb)'},{n:61,l:'C_total',s:'pre-EWSB',c:'var(--grn)'}].forEach(function(x){
    h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:5px;padding:10px;text-align:center"><div style="font-size:22px;font-weight:700;color:'+x.c+'">'+x.n+'</div><div style="font-size:10px;color:var(--dm);margin-top:2px">'+x.l+'</div><div style="font-size:10px;color:var(--dm)">'+x.s+'</div></div>');
  });
  h.push('</div>');
  h.push('<div><b style="color:var(--br)">Weyl 45:</b> Each gen: Q_L(6)+u_R(3)+d_R(3)+L_L(2)+e_R(1)=15. \u00d73 = 45.</div>');
  h.push('<div><b style="color:var(--br)">Higgs 4:</b> Complex SU(2) doublet \u2192 4 real DOF. After EWSB: 3\u2192W\u00b1/Z, 1 physical Higgs.</div>');
  h.push('<div><b style="color:var(--br)">Gauge 12:</b> SU(3):8 + SU(2):3 + U(1):1 = 12 generators.</div>');
  h.push('<div><b style="color:var(--br)">Key:</b> <span style="color:var(--grn)">N_gauge + N_Higgs = N_mult \u2192 12+4=16 = \u03a9_DM</span></div>');
  h.push('</div></div>');

  // Panel 2: Planck
  h.push('<div class="bp-panel" id="bp-p2"><div style="font-family:var(--mn);font-size:12px">');
  h.push('<div style="margin-bottom:8px;font-size:11px;color:var(--dm)">Error = |derived \u2212 observed| / observed. Dataset: <b style="color:var(--br)">Planck 2018 \u039bCDM (TT,TE,EE+lowE+lensing)</b>, flat prior.</div>');
  brows.forEach(function(r){
    var barW=Math.min(r.err/0.8*100,100);
    h.push('<div style="display:grid;grid-template-columns:60px 55px 55px 1fr 50px;gap:6px;align-items:center;padding:6px 0;border-bottom:1px solid var(--bdr)"><div style="color:var(--br);font-weight:600">'+r.q+'</div><div style="color:var(--grn)">'+r.sym+'</div><div style="color:var(--dm)">'+r.obs+'</div><div style="height:8px;background:var(--bdr);border-radius:2px;overflow:hidden;position:relative"><div style="width:'+barW+'%;height:100%;background:'+r.col+';border-radius:2px"></div></div><div style="text-align:right;color:'+r.col+';font-weight:600">'+r.err.toFixed(2)+'%</div></div>');
  });
  h.push('<div style="text-align:center;color:var(--grn);margin-top:10px;font-size:11px">All 5 within 1\u03c3 \u00b7 max 0.61% \u00b7 mean 0.33%</div></div></div>');

  // Panel 3: Dark Matter
  h.push('<div class="bp-panel" id="bp-p3"><div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.9">');
  h.push('<div style="font-size:13px;font-weight:600;color:var(--br);margin-bottom:8px">Dark matter is not a particle. It is enforcement overhead.</div>');
  h.push('<div>16 capacity references needed for 5 field multiplets \u00d7 3 gens + 1 Higgs:</div>');
  h.push('<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin:8px 0">');
  ['Q_L','u_R','d_R','L_L','e_R','H'].forEach(function(f){h.push('<div style="background:var(--blug);padding:5px 8px;border-radius:4px;text-align:center"><span style="color:var(--blu)">'+f+'</span> \u00d7'+(f==='H'?'1':'3')+'</div>')});
  h.push('</div>');
  h.push('<div>No gauge charge \u2192 invisible to photons. Gravitationally active via T9_grav.</div>');
  h.push('<div style="color:var(--amb);margin-top:6px">Prediction: No WIMP detection. No annihilation signal. DM \u201cparticle\u201d searches find nothing.</div></div></div>');

  // Panel 4: Majorana
  h.push('<div class="bp-panel" id="bp-p4"><div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.9">');
  h.push('<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:10px 0">');
  h.push('<div style="background:var(--grng);border:1px solid #34d39920;border-radius:6px;padding:12px;text-align:center"><div style="font-size:20px;font-weight:700;color:var(--grn)">C = 61</div><div style="font-size:12px;color:var(--br)">Majorana (no \u03bd_R)</div><div style="color:var(--grn)">\u03a9_m = 0.3115</div><div style="font-size:11px;color:var(--dm)">0.12% from Planck \u2714</div></div>');
  h.push('<div style="background:var(--ambg);border:1px solid #fbbf2420;border-radius:6px;padding:12px;text-align:center"><div style="font-size:20px;font-weight:700;color:var(--amb)">C = 64</div><div style="font-size:12px;color:var(--br)">Dirac (3 \u03bd_R)</div><div style="color:var(--red)">\u03a9_m = 0.297</div><div style="font-size:11px;color:var(--dm)">2.5\u03c3 tension \u2718</div></div>');
  h.push('</div>');
  h.push('<div>Experiments: <span style="color:var(--amb)">LEGEND-200, nEXO, CUPID</span> \u2014 0\u03bd\u03b2\u03b2 decay search.</div></div></div>');

  // Panel 5: Not a fit
  h.push('<div class="bp-panel" id="bp-p5"><div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:2">');
  h.push('<div style="font-size:13px;font-weight:600;color:var(--br);margin-bottom:8px">Why this is not curve-fitting</div>');
  [{i:'\u2460',t:'All values are <b style="color:var(--grn)">rational ratios</b> fixed before comparison',d:'3/61, 16/61, 42/61, 3/19 \u2014 from integer DOF counting.'},{i:'\u2461',t:'<b style="color:var(--grn)">Zero</b> continuous parameters were tuned',d:'Only inputs: 5 axioms A1\u2013A5.'},{i:'\u2462',t:'Each quantity from a <b style="color:var(--grn)">different constraint sector</b>',d:'\u03a9_\u039b from vacuum (T11), \u03a9_DM from multiplets (T12E), \u03a9_b from generations (T4F).'},{i:'\u2463',t:'Removing any axiom <b style="color:var(--red)">breaks</b> at least one row',d:'Drop A1: no finite capacity. Drop A2: no anomaly cancellation. Drop A5: gauge not unique.'},{i:'\u2464',t:'Same framework derives <b style="color:var(--grn)">gauge group, generations, and charges</b>',d:'sin\u00b2\u03b8_W, N_gen=3, SU(3)\u00d7SU(2)\u00d7U(1) from the same 5 axioms.'}].forEach(function(x){
    h.push('<div style="margin-bottom:8px"><span style="color:var(--pur);font-size:14px;margin-right:6px">'+x.i+'</span> '+x.t+'<div style="margin-left:24px;font-size:11px;color:var(--dm)">'+x.d+'</div></div>');
  });
  h.push('</div></div>');

  // Panel 6: Falsifiability
  h.push('<div class="bp-panel" id="bp-p6"><div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.9">');
  [{q:'\u03a9_DM',f:'If DM carried SM gauge charge, the labeled/unlabeled partition breaks.',c:'var(--blu)'},{q:'\u03a9_\u039b',f:'If vacuum energy were field-dependent (quintessence), ratio would run with redshift.',c:'var(--pur)'},{q:'\u03a9_b',f:'Discovery of 4th generation at any mass \u2192 3/61 becomes 4/X.',c:'var(--grn)'},{q:'C=61',f:'Dirac neutrinos (no 0\u03bd\u03b2\u03b2) \u2192 C=64, shifting all \u03a9 ratios ~5%.',c:'var(--amb)'},{q:'All ratios',f:'Planck+BAO+BBN central values moving >3\u03c3 makes integer ratios implausible.',c:'var(--red)'}].forEach(function(x){
    h.push('<div style="border-left:3px solid '+x.c+';padding:6px 10px;margin-bottom:6px;border-radius:0 4px 4px 0;background:var(--bg)"><span style="color:var(--br);font-weight:600">'+x.q+':</span> '+x.f+'</div>');
  });
  h.push('</div></div>');
  h.push('</div></div>');

  //  SUMMARY CARDS 
  h.push('<div class="sec"><div class="sec-t">Framework Status</div>');
  h.push('<div class="sec-intro">High-level health metrics for the theorem chain. All 49 theorems pass; the epistemic breakdown shows how many are rigorously proven vs. structurally derived.</div><div class="sg">');
  h.push('<div class="sc" data-a="g" onclick="toggleCard(this)"><div class="sc-top"><span class="sc-arrow">\u25bc</span><div class="sc-l">Theorems</div><div class="sc-v" style="color:var(--grn)">'+d.passed+'/'+d.total_theorems+'</div><div class="sc-s">all pass</div></div><div class="sc-expand"><div class="sc-inner" style="padding-top:10px">');
  Object.entries(tiers).forEach(function(e){var k=e[0],v=e[1];h.push('<div class="mini-bar"><span style="width:90px;color:'+TC[k]+'">'+(v.name||'')+'</span><div class="mini-bar-bg"><div class="mini-bar-fill" style="width:'+(v.total>0?v.passed/v.total*100:0)+'%;background:'+TC[k]+'"></div></div><span style="color:var(--br);width:28px;text-align:right">'+v.passed+'/'+v.total+'</span></div>')});
  h.push('</div></div></div>');
  h.push('<div class="sc" data-a="b" onclick="toggleCard(this)"><div class="sc-top"><span class="sc-arrow">\u25bc</span><div class="sc-l">Proven [P]</div><div class="sc-v" style="color:var(--blu)">'+pC+'</div><div class="sc-s">'+pPct+'%</div></div><div class="sc-expand"><div class="sc-inner" style="padding-top:10px">');
  Object.entries(tiers).forEach(function(e){var k=e[0];var th=tierThms[parseInt(k)]||[];var pc=th.filter(function(t){return t.epistemic==='P'}).length;h.push('<div class="mini-bar"><span style="width:90px;color:'+TC[k]+'">Tier '+k+'</span><div class="mini-bar-bg"><div class="mini-bar-fill" style="width:'+(th.length>0?pc/th.length*100:0)+'%;background:var(--grn)"></div></div><span style="color:var(--grn);width:20px;text-align:right">'+pc+'</span></div>')});
  h.push('</div></div></div>');
  h.push('<div class="sc" data-a="p" onclick="toggleCard(this)"><div class="sc-top"><span class="sc-arrow">\u25bc</span><div class="sc-l">Constants</div><div class="sc-v" style="color:var(--pur)">44</div><div class="sc-s">full TOE map</div></div><div class="sc-expand"><div class="sc-inner" style="padding-top:10px;font-family:var(--mn);font-size:11px;line-height:1.8">');
  var epiCount={P:0,P_structural:0,C_import:0,testable:0,open:0};
  TOE.forEach(function(c){epiCount[c.epi]=(epiCount[c.epi]||0)+1});
  h.push('<div style="color:var(--grn)">\u25cf '+epiCount.P+' Proven [P] \u2014 derived exactly</div>');
  h.push('<div style="color:var(--blu)">\u25cf '+epiCount.P_structural+' Structural [P_s] \u2014 derived, regime-conditional</div>');
  h.push('<div style="color:var(--amb)">\u25cf '+epiCount.C_import+' Import-gated [C] \u2014 uses QFT coefficients</div>');
  h.push('<div style="color:var(--pur)">\u25cf '+epiCount.testable+' Testable \u2014 awaiting experiment</div>');
  h.push('<div style="color:var(--dm)">\u25cf '+epiCount.open+' Open \u2014 TOE gaps remaining</div>');
  h.push('</div></div></div>');
  h.push('<div class="sc" data-a="a" onclick="toggleCard(this)"><div class="sc-top"><span class="sc-arrow">\u25bc</span><div class="sc-l">Open</div><div class="sc-v" style="color:var(--amb)">'+epiCount.open+'</div><div class="sc-s">TOE gaps</div></div><div class="sc-expand"><div class="sc-inner" style="padding-top:10px;font-family:var(--mn);font-size:12px;line-height:1.7">');
  h.push('<div style="color:var(--amb)">Yukawa sector <span style="color:var(--dm)">\u2014 9 fermion masses, CKM values, CP phase</span></div>');
  h.push('<div style="color:var(--amb)">Absolute scale <span style="color:var(--dm)">\u2014 \u03ba, M_P, \u039b_QCD, m_H absolute value</span></div>');
  h.push('<div style="color:var(--amb)">Neutrino sector <span style="color:var(--dm)">\u2014 PMNS, \u03bd masses (bounded), CP</span></div>');
  h.push('<div style="color:var(--amb)">Strong CP <span style="color:var(--dm)">\u2014 why \u03b8_QCD \u2248 0</span></div>');
  h.push('</div></div></div>');
  h.push('</div></div>');

  //  PARTICLES 
  h.push('<div class="sec"><div class="sec-t">Particle Content</div>');
  h.push('<div class="sec-intro">The Standard Model field content\u2014quarks, leptons, gauge bosons, and the Higgs\u2014derived from capacity constraints. Three generations of matter, anomaly-free charges, and chiral structure all emerge from the requirement that enforcement be finite and consistent.</div>');
  h.push('<div class="card" style="padding:16px">');
  // Generation structure
  h.push('<div style="font-size:13px;font-weight:600;color:var(--br);margin-bottom:10px">Three Generations from Capacity Saturation</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin-bottom:14px">Each generation of matter (a quark doublet + lepton doublet + right-handed singlets) costs enforcement capacity. The electroweak capacity budget C_EW = 8 admits exactly 3 generations: E(3) = 6 \u2264 8 < 10 = E(4). A 4th generation would overflow the budget.</div>');
  h.push('<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px">');
  ['1st: (u, d, e, \u03bd_e)','2nd: (c, s, \u03bc, \u03bd_\u03bc)','3rd: (t, b, \u03c4, \u03bd_\u03c4)'].forEach(function(g,i){
    h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:6px;padding:12px;text-align:center">');
    h.push('<div style="font-size:14px;font-weight:700;color:var(--grn)">Gen '+(i+1)+'</div>');
    h.push('<div style="font-size:12px;color:var(--dm);margin-top:2px">'+g+'</div>');
    h.push('<div style="font-size:10px;color:var(--dm);margin-top:4px">Cost: E = '+((i+1)*2)+' / 8 capacity</div></div>');
  });
  h.push('</div>');
  // Charges table
  h.push('<div style="font-size:13px;font-weight:600;color:var(--br);margin-bottom:8px">Charge Assignments from Anomaly Cancellation</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin-bottom:10px">Charges are not inputs\u2014they are outputs of the requirement that quantum anomalies cancel (T5). The fractional quark charges (2/3, \u22121/3) and integer lepton charges (\u22121, 0) are the unique solution.</div>');
  h.push('<div style="display:grid;grid-template-columns:90px 60px 60px 60px 1fr;gap:4px;font-family:var(--mn);font-size:11px;margin-bottom:16px">');
  h.push('<div style="font-weight:600;color:var(--dm);padding:4px 0;border-bottom:1px solid var(--bdr)">Field</div><div style="font-weight:600;color:var(--dm);padding:4px 0;border-bottom:1px solid var(--bdr)">SU(3)</div><div style="font-weight:600;color:var(--dm);padding:4px 0;border-bottom:1px solid var(--bdr)">SU(2)</div><div style="font-weight:600;color:var(--dm);padding:4px 0;border-bottom:1px solid var(--bdr)">Y</div><div style="font-weight:600;color:var(--dm);padding:4px 0;border-bottom:1px solid var(--bdr)">Q = T\u2083 + Y</div>');
  var fields=[
    {n:'Q_L (quark doublet)',c:'\u25a0\u25a0\u25a0',w:'\u25a0\u25a0',y:'+1/6',q:'u: +2/3, d: \u22121/3'},
    {n:'u_R (up singlet)',c:'\u25a0\u25a0\u25a0',w:'\u25a1',y:'+2/3',q:'+2/3'},
    {n:'d_R (down singlet)',c:'\u25a0\u25a0\u25a0',w:'\u25a1',y:'\u22121/3',q:'\u22121/3'},
    {n:'L_L (lepton doublet)',c:'\u25a1',w:'\u25a0\u25a0',y:'\u22121/2',q:'\u03bd: 0, e: \u22121'},
    {n:'e_R (electron singlet)',c:'\u25a1',w:'\u25a1',y:'\u22121',q:'\u22121'},
    {n:'\u03bd_R (if Majorana)',c:'\u25a1',w:'\u25a1',y:'0',q:'0'}
  ];
  fields.forEach(function(f){
    h.push('<div style="padding:3px 0;color:var(--br)">'+f.n+'</div><div style="padding:3px 0;color:var(--pur)">'+f.c+'</div><div style="padding:3px 0;color:var(--blu)">'+f.w+'</div><div style="padding:3px 0;color:var(--amb)">'+f.y+'</div><div style="padding:3px 0;color:var(--grn)">'+f.q+'</div>');
  });
  h.push('</div>');
  // Gauge bosons
  h.push('<div style="font-size:13px;font-weight:600;color:var(--br);margin-bottom:8px">Force Carriers</div>');
  h.push('<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:12px">');
  [{n:'Gluons',c:'8',g:'SU(3)',cl:'var(--pur)',d:'Color confinement'},{n:'W\u00b1, Z',c:'3',g:'SU(2)',cl:'var(--blu)',d:'Weak force + SSB'},{n:'Photon',c:'1',g:'U(1)',cl:'var(--amb)',d:'Electromagnetic'},{n:'Higgs',c:'1',g:'scalar',cl:'var(--grn)',d:'SSB enforcement'}].forEach(function(b){
    h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:6px;padding:10px;text-align:center">');
    h.push('<div style="font-size:16px;font-weight:700;color:'+b.cl+'">'+b.c+'</div>');
    h.push('<div style="font-size:12px;color:var(--br)">'+b.n+'</div>');
    h.push('<div style="font-size:10px;color:var(--dm)">'+b.g+' \u00b7 '+b.d+'</div></div>');
  });
  h.push('</div>');
  h.push('<div style="font-family:var(--mn);font-size:11px;color:var(--dm);text-align:center;padding:6px;background:var(--bg);border:1px solid var(--bdr);border-radius:4px">Total: 12 gauge bosons + 1 Higgs + 45 Weyl fermions (per generation \u00d7 3) = <b style="color:var(--grn)">61 DOF</b> = C_total capacity budget</div>');
  h.push('</div></div>');

//  GRAVITY 
  h.push('<div class="sec"><div class="sec-t">Gravity Derivation</div>');
  h.push('<div class="sec-intro">General relativity is not separately postulated\u2014it emerges from the same five axioms that produce the Standard Model. When two subsystems share enforcement, the bookkeeping cost of that shared load <em>is</em> a metric tensor. Lovelock\u2019s theorem then uniquely selects the Einstein field equations in d = 4.</div>');
  h.push('<div class="card" style="padding:16px">');

  // Derivation chain
  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-bottom:12px">Derivation Chain: A1\u2013A5 \u2192 General Relativity</div>');
  var gchain=[
    {c:'#a78bfa',t:'T7B',n:'Non-factorization \u2192 Metric',b:'P_structural',
     d:'Subsystems sharing enforcement load have a non-factorizing interface. The external feasibility functional must be quadratic, local, universal, and endpoint-symmetric.',
     math:'$\\text{Cost}(\\delta) \\propto \\delta^2 \\;\\Rightarrow\\; \\exists\\, g_{\\mu\\nu}:\\; ds^2 = g_{\\mu\\nu}\\,dx^\\mu dx^\\nu$',
     dep:'A1 + A4',k:'$E_{\\rm mix} \\neq 0 \\;\\Rightarrow\\; g_{\\mu\\nu}$ exists'},
    {c:'#60a5fa',t:'T8',n:'Spacetime dimension $d = 4$',b:'P_structural',
     d:'Graviton DOF $= d(d{-}3)/2$. For $d=3$: 0 DOF (topological, violates A4). $d=4$: 2 DOF (minimum propagating). $d \\geq 5$: extra modes, no A5 benefit.',
     math:'$\\text{DOF}(d) = \\frac{d(d-3)}{2} \\quad\\Rightarrow\\quad \\text{DOF}(4) = 2 \\;\\;\\checkmark$',
     dep:'T_gauge + A1 + A4 + A5',k:'$d = 4$ (minimum admissible)'},
    {c:'#34d399',t:'T9',n:'Einstein Field Equations',b:'P + Lovelock',
     d:'Five conditions from $\\Gamma_{\\rm geo}$ closure: locality, coordinate invariance, $\\nabla_\\mu T^{\\mu\\nu} = 0$, $\\leq$ 2nd derivatives, wave propagation.',
     math:'$G_{\\mu\\nu} + \\Lambda g_{\\mu\\nu} = \\kappa\\, T_{\\mu\\nu} \\quad\\text{(unique in } d=4 \\text{, Lovelock 1971)}$',
     dep:'T7B + T8 + \u0393_geo',k:'$G_{\\mu\\nu} + \\Lambda g_{\\mu\\nu} = \\kappa T_{\\mu\\nu}$'},
    {c:'#fbbf24',t:'T10',n:'Gravitational Coupling',b:'P_structural (scaling)',
     d:'$T_{\\mu\\nu}$ = committed internal enforcement. Curvature = external feasibility variation. $\\kappa$ has dimensions $[\\text{capacity}]^{-1}$.',
     math:'$\\kappa \\sim \\frac{1}{C_*} \\quad\\Rightarrow\\quad G_N = \\frac{\\hbar c}{C_*} \\quad\\text{(O(1) prefactor open)}$',
     dep:'T9 + A1',k:'$G_N \\sim \\hbar c / C_*$'},
    {c:'#a78bfa',t:'T11',n:'Cosmological Constant $\\Lambda > 0$',b:'P_structural',
     d:'Of 61 capacity entries, 42 are unlabeled vacuum. Near-saturation: $\\Lambda/M_P^4 \\sim 10^{-120}$ is an integer ratio $\\div\\, C_*^2$, not fine-tuned.',
     math:'$\\Omega_\\Lambda = \\frac{42}{61} = 0.6885 \\quad\\text{(Planck: } 0.6889 \\pm 0.0056\\text{, 0.05\\% off)}$',
     dep:'T3 + T9',k:'$\\Lambda = (42/61) \\times \\text{scale}$'}
  ]
  gchain.forEach(function(g,i){
    if(i>0)h.push('<div style="text-align:center;color:var(--dm);font-size:14px;margin:-4px 0">\u25bc</div>');
    h.push('<div style="border-left:3px solid '+g.c+';padding:8px 12px;margin-bottom:2px;background:var(--bg);border-radius:0 4px 4px 0">');
    h.push('<div style="display:flex;justify-content:space-between;align-items:center"><b style="color:'+g.c+'">'+g.t+': '+g.n+'</b><span class="badge" style="background:'+g.c+'20;color:'+g.c+';font-size:9px">'+g.b+'</span></div>');
    h.push('<div style="margin:4px 0;font-family:var(--mn);font-size:12px;color:var(--dm)">'+g.d+'</div>');
    if(g.math)h.push('<div style="margin:4px 0 6px;padding:6px 10px;background:var(--bg);border:1px solid var(--bdr);border-radius:4px;font-size:14px;color:var(--grn)">'+g.math+'</div>');
    h.push('<div style="font-size:11px;color:var(--dm)">Deps: '+g.dep+' \u00b7 Result: <span style="color:var(--grn)">'+g.k+'</span></div></div>');
  });
  h.push('<div style="text-align:center;font-size:11px;color:var(--dm);margin:8px 0 20px;padding:6px;background:var(--bg);border:1px solid var(--bdr);border-radius:4px">Only external import: <b style="color:var(--amb)">Lovelock\u2019s theorem</b> (1971, pure math). Everything else from A1\u2013A5.</div>');

  // Graviton spectrum
  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-bottom:10px;padding-top:8px;border-top:1px solid var(--bdr)">Graviton Spectrum</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin-bottom:10px">The graviton\u2019s properties are not assumed\u2014they follow from the metric being a symmetric rank-2 tensor in d = 4 dimensions.</div>');
  h.push('<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px">');
  h.push('<div style="background:var(--grng);border-radius:6px;padding:14px;text-align:center"><div style="font-size:22px;font-weight:700;color:var(--grn)">m = 0</div><div style="font-size:11px;color:var(--dm)">massless (diffeo invariance)</div></div>');
  h.push('<div style="background:var(--blug);border-radius:6px;padding:14px;text-align:center"><div style="font-size:22px;font-weight:700;color:var(--blu)">s = 2</div><div style="font-size:11px;color:var(--dm)">spin-2 (\u03b4g_\u03bc\u03bd sym rank-2)</div></div>');
  h.push('<div style="background:var(--purg);border-radius:6px;padding:14px;text-align:center"><div style="font-size:22px;font-weight:700;color:var(--pur)">h = \u00b12</div><div style="font-size:11px;color:var(--dm)">2 polarizations (SO(2) in d=4)</div></div>');
  h.push('</div>');
  // DOF elimination
  h.push('<div style="display:grid;grid-template-columns:1fr auto 1fr auto 1fr auto 1fr;gap:4px;align-items:center;margin-bottom:14px;text-align:center">');
  h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:5px;padding:8px"><div style="font-size:16px;font-weight:700;color:var(--tx)">10</div><div style="font-size:9px;color:var(--dm)">sym tensor</div></div>');
  h.push('<div style="color:var(--red);font-size:12px">\u2212 4</div>');
  h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:5px;padding:8px"><div style="font-size:16px;font-weight:700;color:var(--amb)">6</div><div style="font-size:9px;color:var(--dm)">Bianchi</div></div>');
  h.push('<div style="color:var(--red);font-size:12px">\u2212 4</div>');
  h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:5px;padding:8px"><div style="font-size:16px;font-weight:700;color:var(--grn)">2</div><div style="font-size:9px;color:var(--dm)">diffeo gauge</div></div>');
  h.push('<div style="color:var(--grn);font-size:12px">=</div>');
  h.push('<div style="background:var(--grng);border:1px solid var(--grn);border-radius:5px;padding:8px"><div style="font-size:16px;font-weight:700;color:var(--grn)">2</div><div style="font-size:9px;color:var(--dm)">h_+ and h_\u00d7</div></div>');
  h.push('</div>');
  // Dimension table
  h.push('<div style="display:grid;grid-template-columns:40px 50px 65px 1fr;gap:4px;font-family:var(--mn);font-size:11px;margin-bottom:16px">');
  h.push('<div style="font-weight:600;color:var(--dm);padding:3px 0;border-bottom:1px solid var(--bdr)">d</div><div style="font-weight:600;color:var(--dm);padding:3px 0;border-bottom:1px solid var(--bdr)">DOF</div><div style="font-weight:600;color:var(--dm);padding:3px 0;border-bottom:1px solid var(--bdr)">Little grp</div><div style="font-weight:600;color:var(--dm);padding:3px 0;border-bottom:1px solid var(--bdr)">Status</div>');
  [{d:'3',dof:'0',lg:'SO(1)',s:'Topological\u2014no GW, violates A4.',c:'var(--red)'},{d:'4',dof:'2',lg:'SO(2)',s:'Minimum propagating. 2 helicities. Knot stability. \u2714 Selected.',c:'var(--grn)'},{d:'5',dof:'5',lg:'SO(3)',s:'Extra modes, no admissibility benefit (A5).',c:'var(--amb)'}].forEach(function(r){
    h.push('<div style="color:'+r.c+';font-weight:600;padding:2px 0">'+r.d+'</div><div style="color:'+r.c+'">'+r.dof+'</div><div style="padding:2px 0">'+r.lg+'</div><div style="padding:2px 0">'+r.s+'</div>');
  });
  h.push('</div>');

  // Gauge || Gravity parallel
  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-bottom:10px;padding-top:8px;border-top:1px solid var(--bdr)">Two Geometries from One Capacity</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin-bottom:10px">Gauge theory and gravity are not independent postulates. They are the internal and external manifestations of a single finite capacity bound (A1).</div>');
  h.push('<div style="display:grid;grid-template-columns:1fr 50px 1fr;gap:8px;margin-bottom:12px">');
  h.push('<div style="background:var(--blug);border:1px solid var(--blu);border-radius:6px;padding:12px"><div style="font-size:12px;font-weight:700;color:var(--blu);margin-bottom:6px">Internal (Fiber) \u2192 Gauge</div><div style="font-family:var(--mn);font-size:11px;color:var(--dm);line-height:1.7"><div>Bundle: Principal G-bundle P \u2192 M</div><div>Connection: A_\u03bc (gauge field)</div><div>Curvature: F_\u03bc\u03bd = enforcement cost</div><div style="color:var(--blu);margin-top:4px">Measures: distinguishable internal DOF</div></div></div>');
  h.push('<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--dm);font-size:11px"><div style="font-size:14px">\u2194</div><div>same A1</div></div>');
  h.push('<div style="background:var(--purg);border:1px solid var(--pur);border-radius:6px;padding:12px"><div style="font-size:12px;font-weight:700;color:var(--pur);margin-bottom:6px">External (Base) \u2192 Gravity</div><div style="font-family:var(--mn);font-size:11px;color:var(--dm);line-height:1.7"><div>Bundle: Metric on tangent TM</div><div>Connection: \u0393\u1d68_\u03bc\u03bd (Christoffel)</div><div>Curvature: R\u1d68_\u03c3\u03bc\u03bd = capacity gradient</div><div style="color:var(--pur);margin-top:4px">Measures: total capacity per point</div></div></div>');
  h.push('</div>');
  h.push('<div style="background:var(--bg);border:1px solid var(--bdr);border-radius:5px;padding:10px;font-family:var(--mn);font-size:12px;color:var(--dm);margin-bottom:16px">C(x) = C_spacetime(x) \u00d7 C_internal(x). A1 constrains the product \u2192 more internal structure = less spacetime capacity = curvature. <span style="color:var(--grn)">Einstein\u2019s equation: spacetime capacity geometry = internal capacity usage.</span></div>');

  // Red team audit
  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-bottom:10px;padding-top:8px;border-top:1px solid var(--bdr)">Red Team Audit</div>');
  h.push('<div style="font-family:var(--mn);font-size:12px;color:var(--dm);line-height:1.8;margin-bottom:10px">Independent review of the gravity derivation, identifying what is solid and where epistemic overclaims need correction.</div>');
  h.push('<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">');
  h.push('<div><div style="font-size:12px;font-weight:600;color:var(--grn);margin-bottom:8px">\u2714 6 Solid Results</div>');
  ['EFE via Lovelock: clean chain, no gaps.','Graviton spin-2: standard linearized GR.','2 helicities: SO(2) little group in d=4.','Semi-classical limit: Ehrenfest recovery.','Scaling \u03ba ~ 1/C_*: absolute value honestly open.','Capacity residual \u2192 \u039b > 0: sign + smallness explained.'].forEach(function(s){h.push('<div style="border-left:2px solid var(--grn);padding:3px 8px;margin-bottom:4px;font-size:11px">'+s+'</div>')});
  h.push('</div><div><div style="font-size:12px;font-weight:600;color:var(--red);margin-bottom:8px">\u2718 5 Issues Found</div>');
  [{s:'HIGH',c:'var(--red)',t:'KMS discreteness claim',f:'Remove. Type III\u2081 = continuous spectrum.'},{s:'MED',c:'var(--amb)',t:'Quantum EFE overclaimed',f:'Downgrade to [open_physics].'},{s:'MED',c:'var(--amb)',t:'m=0 from modular invariance',f:'Attribute to diffeomorphism invariance.'},{s:'MED',c:'var(--amb)',t:'Spectral triple not constructed',f:'Mark [open_physics].'},{s:'LOW',c:'var(--blu)',t:'Two routes unreconciled',f:'Lovelock primary; cost func. complementary.'}].forEach(function(x){h.push('<div style="border-left:2px solid '+x.c+';padding:3px 8px;margin-bottom:4px;font-size:11px"><span style="color:'+x.c+';font-weight:600">'+x.s+':</span> '+x.t+'<br><span style="color:var(--grn);font-size:10px">Fix: '+x.f+'</span></div>')});
  h.push('</div></div>');

  h.push('</div></div>');

//  QUANTUM FOUNDATIONS 
  h.push('<div class="sec"><div class="sec-t">Quantum Foundations</div>');
  h.push('<div class="sec-intro">Quantum mechanics is not assumed\u2014it is derived. The non-closure axiom (A2) forces contextuality, which forces a non-commutative C*-algebra, which forces Hilbert space. The Born rule, operator structure, and time evolution all emerge from constraint logic.</div>');
  h.push('<div class="card" style="padding:16px">');

  h.push('<div style="font-size:14px;font-weight:700;color:var(--br);margin-bottom:12px">A2 (Non-Closure) \u2192 Quantum Mechanics</div>');
  var qsteps=[
    {c:'#a78bfa',t:'Non-closure (A2)',d:'No finite set of checks closes the enforcement ledger. Always a residual.',
     math:'$\\forall\\, S \\subset \\mathcal{O},\\; |S| < \\infty \\;\\Rightarrow\\; \\exists\\, O \\notin \\overline{S}$',b:'axiom'},
    {c:'#60a5fa',t:'Contextuality (T1)',d:'Measurement outcomes depend on joint context. Kochen-Specker theorem (1967).',
     math:'$\\nexists\\; v: \\mathcal{O} \\to \\{0,1\\} \\;\\text{s.t.}\\; \\sum_{O \\in B} v(O) = 1 \\;\\;\\forall\\, \\text{basis } B$',b:'P (theorem)'},
    {c:'#34d399',t:'Non-Boolean Lattice',d:'Propositions form an orthomodular lattice. Classical distributive logic fails.',
     math:'$\\mathcal{L}(\\mathcal{O}) \\text{ orthomodular but } a \\wedge (b \\vee c) \\neq (a \\wedge b) \\vee (a \\wedge c)$',b:'P (theorem)'},
    {c:'#fbbf24',t:'Hilbert Space (T2)',d:'Piron-Sol\u00e8r (1995): orthomodular + covering \u2192 closed subspaces of $\\mathcal{H}$ over $\\mathbb{R}, \\mathbb{C},$ or $\\mathbb{H}$.',
     math:'$\\mathcal{L} \\cong \\mathcal{L}(\\mathcal{H}) \\quad\\text{for some Hilbert space } \\mathcal{H}$',b:'P (import)'},
    {c:'#f87171',t:'Complex $C^*$-algebra',d:'Composition (A3) requires interference $\\Rightarrow\\, \\mathbb{C}$. GNS: non-commutative $C^*$-algebra. A1 $\\Rightarrow$ Type III$_1$ factor.',
     math:'$\\mathcal{A} \\text{ is a Type III}_1 \\text{ von Neumann factor on } \\mathcal{H}$',b:'P_structural'},
    {c:'#a78bfa',t:'Modular Time',d:'A4 + KMS condition $\\Rightarrow$ Tomita-Takesaki modular automorphism as canonical time.',
     math:'$\\sigma_t(A) = \\Delta^{it} A\\, \\Delta^{-it}, \\quad \\Delta = S^* S \\;\\;\\text{(Tomita 1967)}$',b:'P'}
  ]
  qsteps.forEach(function(q,i){
    if(i>0)h.push('<div style="text-align:center;color:var(--dm);font-size:12px;margin:-2px 0">\u25bc</div>');
    h.push('<div style="border-left:3px solid '+q.c+';padding:8px 12px;margin-bottom:2px;background:var(--bg);border-radius:0 4px 4px 0">');
    h.push('<div style="display:flex;justify-content:space-between;align-items:center"><b style="color:'+q.c+'">'+q.t+'</b><span class="badge" style="background:'+q.c+'20;color:'+q.c+';font-size:9px">'+q.b+'</span></div>');
    h.push('<div style="margin:3px 0;font-family:var(--mn);font-size:12px;color:var(--dm)">'+q.d+'</div>');
    if(q.math)h.push('<div style="margin:2px 0 4px;padding:5px 10px;background:var(--bg);border:1px solid var(--bdr);border-radius:4px;font-size:14px;color:var(--pur)">'+q.math+'</div>');
    h.push('</div>');
  });

  h.push('<div style="margin-top:16px;font-size:14px;font-weight:700;color:var(--br);margin-bottom:10px;padding-top:8px;border-top:1px solid var(--bdr)">Quantum Gravity Bridge</div>');
  h.push('<div style="background:var(--ambg);border:1px solid var(--amb);border-radius:5px;padding:8px 10px;margin-bottom:10px;font-family:var(--mn);font-size:12px"><b style="color:var(--amb)">\u26a0</b> This is a structural sketch [open_physics], not a completed derivation. 3 of 5 steps are proved; 2 remain open.</div>');
  var bridge=[
    {n:'\u2460 Operator algebra',ok:true,d:'A2 \u2192 Type III\u2081 von Neumann factor. <b>Theorem (T2).</b>'},
    {n:'\u2461 KMS + modular flow',ok:true,d:'A4 \u2192 KMS state \u2192 Tomita-Takesaki \u03c3_t. <b>Math theorem.</b>'},
    {n:'\u2462 Metric \u2192 operator',ok:false,d:'Promote g_\u03bc\u03bd to operator on Type III\u2081. Dirac operator D not yet constructed.'},
    {n:'\u2463 Operator EFE',ok:false,d:'Modular variation \u03b4S/\u03b4A not rigorously defined on non-commutative algebra.'},
    {n:'\u2464 Semi-classical limit',ok:true,d:'Ehrenfest: \u27e8\u011c_\u03bc\u03bd\u27e9 \u2192 G_\u03bc\u03bd. <b>Standard and clean.</b>'}
  ];
  bridge.forEach(function(b){
    var c=b.ok?'var(--grn)':'var(--amb)';
    var bg=b.ok?'var(--bg)':'var(--ambg)';
    h.push('<div style="border-left:3px solid '+c+';padding:6px 10px;margin-bottom:4px;background:'+bg+';border-radius:0 4px 4px 0;font-family:var(--mn);font-size:12px;color:var(--dm)"><b style="color:var(--br)">'+b.n+'</b> '+(b.ok?'<span style="color:var(--grn)">\u2714</span>':'<span style="color:var(--amb)">\u25cb</span>')+' '+b.d+'</div>');
  });
  h.push('<div style="text-align:center;font-size:11px;color:var(--dm);margin-top:8px;padding:6px;background:var(--bg);border:1px solid var(--bdr);border-radius:4px"><b>3/5 steps proved.</b> Full quantum gravity remains the open frontier.</div>');

  h.push('</div></div>');

  
  //  VISUALIZATIONS 

  //  CHANGELOG 
  h.push('<div class="sec"><div class="sec-t">Version History</div>');
  h.push('<div class="sec-intro">How the framework has evolved. Each version closes gaps, upgrades epistemic status, or adds new derivations.</div>');
  h.push('<div class="card" style="padding:16px">');

  var versions=[
    {v:'3.6',d:'2026-02-08',items:[
      {t:'upgrade',s:'T6 $[P_s] \\to [P]$: $\\sin^2\\theta_W(M_U) = 3/8$ via SU(5) embedding (pure Lie algebra)'},
      {t:'upgrade',s:'T_field $[P_s] \\to [P]$: field content uniquely derived (Landau pole + CPT)'},
      {t:'new',s:'T12E: $f_b = 3/19$ (baryon fraction, 0.49% Planck, combinatorial)'},
      {t:'new',s:'T11: $\\Omega_\\Lambda = 42/61$ (0.05% Planck), cosmological budget $3+16+42=61$'},
      {t:'new',s:'Majorana neutrino prediction ($C_{\\rm total} = 61 \\Rightarrow$ no $\\nu_R$)'},
      {t:'new',s:'Boson-multiplet identity: $N_{\\rm gauge} + N_{\\rm Higgs} = N_{\\rm mult} = 16$'},
      {t:'new',s:'Physical corollaries: charge quantization, neutral atoms from anomaly cancellation'},
      {t:'bridge',s:'Einstein equations: Lovelock 1971 verified as pure math import $\\to [P]$'},
      {t:'bridge',s:'Lorentzian signature: HKM 1976 + Malament 1977 bridge $\\to [P]$'}
    ]},
    {v:'3.5',d:'2026-02-07',items:[
      {t:'new',s:'$L_{\\varepsilon^*}$: minimum enforceable distinction (closes finite distinguishability gap)'},
      {t:'new',s:'Complete gravity closure: $\\Gamma_{\\rm geo}$ engine with A9.1\u2013A9.5 Einstein selectors'},
      {t:'new',s:'Dark matter = gauge-singlet capacity ($\\Omega_{\\rm DM} = 16/61$)'},
      {t:'upgrade',s:'T7: $N_{\\rm gen} = 3$ upgraded from $[P_s]$ to $[P]$ via capacity saturation'},
      {t:'new',s:'67 tests, GitHub Actions CI, comprehensive deployment infrastructure'}
    ]},
    {v:'3.4',d:'2026-02-01',items:[
      {t:'new',s:'sin\u00b2\u03b8_W derivation chain (T19\u2013T27) with competition matrix'},
      {t:'new',s:'Anomaly scan engine: systematic gauge group selection'},
      {t:'new',s:'Epistemic verifier with audit trail'},
      {t:'upgrade',s:'$L_\\varepsilon$ disambiguation across theorem bank'}
    ]}
  ];
  var typeColors={upgrade:'var(--grn)',new:'var(--blu)',bridge:'var(--pur)',fix:'var(--amb)'};
  var typeLabels={upgrade:'\u2b06 Upgrade',new:'+ New',bridge:'\u2194 Bridge',fix:'\u2699 Fix'};
  versions.forEach(function(ver){
    h.push('<div style="margin-bottom:16px"><div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span style="font-size:16px;font-weight:700;color:var(--grn)">v'+ver.v+'</span><span style="font-size:11px;color:var(--dm)">'+ver.d+'</span></div>');
    ver.items.forEach(function(item){
      var tc=typeColors[item.t]||'var(--dm)';
      h.push('<div style="display:flex;gap:8px;align-items:baseline;margin-bottom:3px;font-family:var(--mn);font-size:12px"><span style="color:'+tc+';font-weight:600;min-width:70px;font-size:10px">'+(typeLabels[item.t]||item.t)+'</span><span style="color:var(--dm)">'+item.s+'</span></div>');
    });
    h.push('</div>');
  });
  h.push('</div></div>');

  h.push('<div class="sec"><div class="sec-t">Enforcement Crystal</div>');
  h.push('<div class="sec-intro">Interactive 3D visualization of the 49-theorem dependency structure. Each node is a theorem colored by tier. Click and drag to rotate; hover for details.</div>');
  h.push('<div id="crystal-box"><div id="crystal-hover"></div>');
  h.push('<div id="crystal-legend"><div class="cl-head">Color = Tier</div>');
  h.push('<div class="cl-r"><div class="cl-dot" style="background:#f87171"></div> Axioms</div>');
  ['T0: Foundations','T1: Gauge','T2: Particles','T3: Constants','T4: Gravity','T5: \u0393 Closure'].forEach(function(l,i){h.push('<div class="cl-r"><div class="cl-dot" style="background:'+TC[i]+'"></div> '+l+'</div>')});
  h.push('</div></div></div>');

  h.push('<div class="sec"><div class="sec-t">Dependency Graph  Force-Directed</div>');
  h.push('<div class="sec-intro">Physics-based spring simulation showing theorem clusters and their connections. Tightly coupled theorems cluster together; weakly connected ones drift apart.</div>');
  h.push('<div class="card" style="position:relative;overflow:hidden"><div id="graph-box" style="width:100%;height:520px;background:var(--cardbg)"></div><div id="gtt" class="tt" style="display:none;position:absolute;pointer-events:none;z-index:10"></div></div></div>');

  h.push('<div class="sec"><div class="sec-t">Dependency Graph  Layered by Tier</div>');
  h.push('<div class="sec-intro">The same theorem dependencies shown as a layered DAG (directed acyclic graph), organized vertically by proof tier. Higher tiers depend on lower ones.</div>');
  h.push('<div class="card" style="overflow:auto"><div id="dag-box" style="width:100%;min-height:600px;background:var(--cardbg)"></div></div></div>');


  h.push('<div class="sec"><div class="sec-t">Theorem Map</div>');
  h.push('<div class="sec-intro">Every theorem in the framework, organized by proof tier. Each row shows the theorem ID, a plain-English summary of what it proves, and its epistemic status. Click any row for the full derivation chain, dependencies, and gap analysis.</div>');
  h.push('<div class="card" style="padding:12px;overflow-x:auto">');
  var allThms=[];
  Object.entries(d.theorems||{}).forEach(function(e){allThms.push(Object.assign({id:e[0]},e[1]))});
  allThms.sort(function(a,b){return (a.tier||0)-(b.tier||0)});
  var lastTier=-99;
  allThms.forEach(function(t){
    var tier=t.tier||0;
    if(tier!==lastTier){
      lastTier=tier;
      var tierNames={0:'Axiom Foundations',1:'Gauge Group Selection',2:'Particle Content & Charges',3:'Continuous Constants & RG Flow',4:'Gravity & Cosmology',5:'\u0393 Closure & UV Completion'};
      h.push('<div style="font-size:13px;font-weight:700;color:'+TC[tier]+';padding:12px 0 4px;border-bottom:2px solid var(--bdr);margin-top:8px">Tier '+tier+': '+(tierNames[tier]||'')+'</div>');
    }
    var ec2=EPI_COLORS[t.epistemic]||['var(--dm)','var(--bg)'];
    var summary=t.summary||'';
    var plainEnglish=t.key_result||summary;
    h.push('<div class="xr"><div class="xr-top" onclick="toggleToe(this.parentNode)">');
    h.push('<div class="xr-dot" style="background:'+ec2[0]+'"></div>');
    h.push('<div class="xr-name">'+(t.id||'')+'</div>');
    h.push('<div class="xr-desc" style="white-space:normal">'+esc(summary)+'</div>');
    h.push('<div class="xr-tier" style="color:'+TC[tier]+'">T'+tier+'</div>');
    h.push('<div><span class="t-epi" style="background:'+ec2[1]+';color:'+ec2[0]+'">'+((t.epistemic||'').replace('P_',''))+'</span></div>');
    h.push('<div class="xr-arrow">\u25bc</div></div>');
    h.push('<div class="toe-expand"><div class="toe-detail">');
    if(t.key_result)h.push('<div class="xd-row"><span class="xd-label">Key result:</span><b style="color:var(--grn)">'+esc(t.key_result)+'</b></div>');
    if(summary&&summary!==t.key_result)h.push('<div class="xd-row"><span class="xd-label">Summary:</span>'+esc(summary)+'</div>');
    if(t.dependencies&&t.dependencies.length)h.push('<div class="xd-row"><span class="xd-label">Depends on:</span>'+t.dependencies.join(', ')+'</div>');
    var depCount=(t.dependencies||[]).length;
    h.push('<div class="xd-row"><span class="xd-label">Proof depth:</span>'+depCount+' direct dependencies, Tier '+tier+'</div>');
    if(t.gap_type)h.push('<div class="xd-row"><span class="xd-label">Gap type:</span><span style="color:'+(t.gap_type==='closed'?'var(--grn)':t.gap_type==='open_physics'?'var(--red)':'var(--amb)')+'">'+esc(t.gap_type)+'</span></div>');
    if(t.gap_analysis)h.push('<div class="xd-row"><span class="xd-label">Gap analysis:</span>'+esc(t.gap_analysis)+'</div>');
    if(t.regime)h.push('<div class="xd-row"><span class="xd-label">Regime:</span><span style="color:var(--amb)">'+esc(t.regime)+'</span></div>');
    h.push('<div class="xd-row"><span class="xd-label">Status:</span><span style="color:'+ec2[0]+'">'+esc(t.epistemic||'')+'</span></div>');
    h.push('</div></div>');
  });
  h.push('</div></div>');


  h.push('<div class="sec"><div class="sec-t">Audit Trail</div>');
  h.push('<div class="sec-intro">Transparency log of all known gaps, their severity, and closure status. Green = closed, amber = reduced, red = open physics.</div>');
  h.push('<div class="card" style="padding:12px;overflow-x:auto">');
  var audits=d.gap_analysis||{};
  Object.entries(audits).forEach(function(e){
    var id=e[0],g=e[1];
    var gc=(g.gap_type==='closed'||g.gap_type==='import')?'var(--grn)':(g.gap_type==='reduced'?'var(--amb)':'var(--red)');
    h.push('<div class="xr"><div class="xr-top" onclick="toggleToe(this.parentNode)"><div class="xr-dot" style="background:'+gc+'"></div><div class="xr-name">'+id+'</div><div class="xr-desc">'+esc(g.anchor||'')+'</div><div style="font-family:var(--mn);font-size:12px;color:'+gc+'">'+esc(g.gap_type||'')+'</div><div></div><div class="xr-arrow">\u25bc</div></div>');
    h.push('<div class="toe-expand"><div class="toe-detail">');
    h.push('<div class="xd-row"><span class="xd-label">Anchor:</span>'+esc(g.anchor||'')+'</div>');
    h.push('<div class="xd-row"><span class="xd-label">Gap:</span>'+esc(g.gap||'')+'</div>');
    if(g.severity)h.push('<div class="xd-row"><span class="xd-label">Severity:</span><span style="color:'+(g.severity==='high'?'var(--red)':'var(--amb)')+'">'+esc(g.severity)+'</span></div>');
    h.push('<div class="xd-row"><span class="xd-label">To close:</span>'+esc(g.to_close||'')+'</div>');
    h.push('<div class="xd-row"><span class="xd-label">Status:</span><span style="color:'+gc+'">'+esc(g.gap_type||'')+'</span></div>');
    h.push('</div></div>');
  });
  h.push('</div></div>');

h.push('<div class="footer">Admissibility Physics Engine '+d.version+' \u00b7 '+d.date+' \u00b7 '+d.total_theorems+' theorems \u00b7 52 constants mapped \u00b7 0 free parameters</div>');

  document.getElementById('app').innerHTML=h.join('\n');
  setTimeout(function(){drawDonut();buildCrystal(d);buildForceGraph(d);buildDAG(d);if(window.MathJax&&MathJax.typesetPromise)MathJax.typesetPromise()},200);
}

function drawDonut(){
  var c=document.getElementById('donut-canvas');if(!c)return;var ctx=c.getContext('2d');
  var cx=90,cy=90,r=72,r2=48;
  var data=[{v:42,c:'#a78bfa'},{v:16,c:'#60a5fa'},{v:3,c:'#34d399'}];
  var cum=-Math.PI/2;
  data.forEach(function(d){var a=d.v/61*Math.PI*2;ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,cum,cum+a);ctx.closePath();ctx.fillStyle=d.c;ctx.globalAlpha=0.75;ctx.fill();cum+=a});
  ctx.globalAlpha=1;ctx.beginPath();ctx.arc(cx,cy,r2,0,Math.PI*2);ctx.fillStyle='#0b0f1a';ctx.fill();
  ctx.font='600 9px IBM Plex Mono';ctx.fillStyle='#4a5575';ctx.textAlign='center';ctx.fillText('\u03a9_total',cx,cy-6);
  ctx.font='800 18px IBM Plex Mono';ctx.fillStyle='#eef0f8';ctx.fillText('0.996',cx,cy+12);
}

function buildCrystal(d) {
  const container = document.getElementById('crystal-box');
  const W = container.clientWidth, H = container.clientHeight;
  
  // Scene setup
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, W/H, 0.1, 100);
  camera.position.set(0, 2, 9);
  camera.lookAt(0, 0, 0);
  
  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(W, H);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setClearColor(0x0b0f1a, 1);
  container.insertBefore(renderer.domElement, container.firstChild);
  
  // Lighting
  const ambLight = new THREE.AmbientLight(0x334466, 0.6);
  scene.add(ambLight);
  const ptLight = new THREE.PointLight(0x60a5fa, 1.2, 20);
  ptLight.position.set(3, 5, 4);
  scene.add(ptLight);
  const ptLight2 = new THREE.PointLight(0xa78bfa, 0.6, 20);
  ptLight2.position.set(-3, -2, 4);
  scene.add(ptLight2);
  
  // Build node data: tiers as rings
  const tierCfg = [
    { tier: -1, y: 3.5, radius: 1.6, ids: ['A1','A2','A3','A4','A5'] },
    { tier: 0, y: 2.2, radius: 2.6 },
    { tier: 1, y: 1.1, radius: 1.3 },
    { tier: 2, y: 0.0, radius: 2.6 },
    { tier: 3, y: -1.3, radius: 3.2 },
    { tier: 4, y: -2.5, radius: 2.3 },
    { tier: 5, y: -3.5, radius: 1.8 },
  ];
  
  // Connectivity-aware ordering per tier
  const allIds = new Set(['A1','A2','A3','A4','A5']);
  Object.keys(d.theorems||{}).forEach(id=>allIds.add(id));
  
  function cleanDep(dep) {
    let dd=dep.trim();
    if(dd.startsWith('A')&&dd.includes(' '))dd=dd.split(' ')[0].split('(')[0].trim();
    if(dd.startsWith('meaning'))return null;
    const rm={'L_epsilon*':'L_*','L_e*':'L_*','_closure':'Gamma_closure'};
    return rm[dd]||dd;
  }
  
  // Get parents for ordering
  const parents = {};
  Object.entries(d.theorems||{}).forEach(([tid,t])=>{
    const ps = new Set();
    (t.dependencies||[]).forEach(dep=>{const cd=cleanDep(dep);if(cd&&allIds.has(cd))ps.add(cd)});
    parents[tid]=ps;
  });
  
  // Group by tier with connectivity ordering
  const tierNodes = {};
  Object.entries(d.theorems||{}).forEach(([tid,t])=>{
    const tier=t.tier??0;
    if(!tierNodes[tier])tierNodes[tier]=[];
    tierNodes[tier].push(tid);
  });
  
  // Greedy nearest-neighbor angular ordering
  for (const tier of Object.keys(tierNodes)) {
    const nodes = tierNodes[tier];
    if (nodes.length <= 2) continue;
    const ordered = [nodes.reduce((a,b)=>(parents[a]||new Set()).size>(parents[b]||new Set()).size?a:b)];
    const remaining = new Set(nodes);
    remaining.delete(ordered[0]);
    while (remaining.size > 0) {
      const last = ordered[ordered.length-1];
      const lp = parents[last]||new Set();
      let best=null, bestScore=-1;
      remaining.forEach(n=>{
        const np=parents[n]||new Set();
        let overlap=0;lp.forEach(p=>{if(np.has(p))overlap++});
        if(overlap>bestScore){bestScore=overlap;best=n}
      });
      ordered.push(best);
      remaining.delete(best);
    }
    tierNodes[tier] = ordered;
  }
  
  // Place nodes in 3D
  const nodePos = {};
  const nodeMeshes = [];
  const nodeData = {};
  const colorMap = { '-1': 0xf87171 };
  TC.forEach((c,i)=>colorMap[String(i)]=parseInt(c.replace('#',''),16));
  
  const crystalGroup = new THREE.Group();
  scene.add(crystalGroup);
  
  tierCfg.forEach(cfg => {
    const ids = cfg.ids || tierNodes[cfg.tier] || [];
    ids.forEach((id, i) => {
      const angle = (i / ids.length) * Math.PI * 2 - Math.PI/2;
      const x = Math.cos(angle) * cfg.radius;
      const z = Math.sin(angle) * cfg.radius;
      const y = cfg.y;
      nodePos[id] = new THREE.Vector3(x, y, z);
      
      const tier = cfg.tier;
      const col = colorMap[String(tier)] || 0x888888;
      const thm = d.theorems?.[id];
      const isAxiom = tier === -1;
      const isPStructural = thm?.epistemic === 'P_structural';
      const fanout = Object.values(d.theorems||{}).filter(t=>(t.dependencies||[]).some(dep=>{const cd=cleanDep(dep);return cd===id})).length;
      const sz = isAxiom ? 0.16 : 0.09 + fanout * 0.012;
      
      let geom, mat;
      if (isAxiom) {
        geom = new THREE.OctahedronGeometry(sz, 0);
        mat = new THREE.MeshPhongMaterial({ color: col, emissive: col, emissiveIntensity: 0.5, transparent: true, opacity: 0.9 });
      } else if (isPStructural) {
        geom = new THREE.BoxGeometry(sz*1.3, sz*1.3, sz*1.3);
        mat = new THREE.MeshPhongMaterial({ color: col, emissive: col, emissiveIntensity: 0.3, transparent: true, opacity: 0.8, wireframe: false });
      } else {
        geom = new THREE.SphereGeometry(sz, 12, 8);
        mat = new THREE.MeshPhongMaterial({ color: col, emissive: col, emissiveIntensity: 0.35, transparent: true, opacity: 0.85 });
      }
      
      const mesh = new THREE.Mesh(geom, mat);
      mesh.position.copy(nodePos[id]);
      if (isPStructural) mesh.rotation.set(Math.PI/4, Math.PI/4, 0);
      mesh.userData = { id, tier, epistemic: thm?.epistemic||'axiom', name: isAxiom?AXNM[id]:(thm?.name||id).replace(/^[^:]+:\s*/,'').slice(0,30), fanout };
      crystalGroup.add(mesh);
      nodeMeshes.push(mesh);
      nodeData[id] = mesh;
    });
  });
  
  // Tier ring wireframes
  tierCfg.forEach(cfg => {
    const ids = cfg.ids || tierNodes[cfg.tier] || [];
    if (ids.length < 3) return;
    const ringPts = [];
    for (let i = 0; i <= 64; i++) {
      const a = (i/64) * Math.PI * 2;
      ringPts.push(new THREE.Vector3(Math.cos(a)*cfg.radius, cfg.y, Math.sin(a)*cfg.radius));
    }
    const ringGeom = new THREE.BufferGeometry().setFromPoints(ringPts);
    const col = colorMap[String(cfg.tier)] || 0x888888;
    const ringMat = new THREE.LineBasicMaterial({ color: col, transparent: true, opacity: 0.12 });
    crystalGroup.add(new THREE.Line(ringGeom, ringMat));
  });
  
  // Dependency edges
  const edgeLines = [];
  Object.entries(d.theorems||{}).forEach(([tid,t])=>{
    (t.dependencies||[]).forEach(dep=>{
      const cd = cleanDep(dep);
      if(cd && nodePos[cd] && nodePos[tid]) {
        const pts = [nodePos[cd], nodePos[tid]];
        const geom = new THREE.BufferGeometry().setFromPoints(pts);
        const sTier = d.theorems?.[cd]?.tier ?? (cd.startsWith('A')?-1:0);
        const tTier = t.tier ?? 0;
        const dist = Math.abs(sTier - tTier);
        const opacity = dist > 2 ? 0.06 : dist > 1 ? 0.1 : 0.15;
        const col = colorMap[String(tTier)] || 0x888888;
        const mat = new THREE.LineBasicMaterial({ color: col, transparent: true, opacity: opacity });
        const line = new THREE.Line(geom, mat);
        crystalGroup.add(line);
        edgeLines.push({ line, source: cd, target: tid });
      }
    });
  });
  
  // Vertical axis line
  const axisPts = [new THREE.Vector3(0, 4, 0), new THREE.Vector3(0, -4, 0)];
  const axisGeom = new THREE.BufferGeometry().setFromPoints(axisPts);
  crystalGroup.add(new THREE.Line(axisGeom, new THREE.LineBasicMaterial({ color: 0x1a2540, transparent: true, opacity: 0.3 })));
  
  // Mouse rotation
  let isDragging = false, prevX = 0, prevY = 0;
  let rotY = 0, rotX = 0.15;
  let autoRotate = true;
  
  renderer.domElement.addEventListener('pointerdown', e => {
    isDragging = true; prevX = e.clientX; prevY = e.clientY; autoRotate = false;
  });
  window.addEventListener('pointerup', () => { isDragging = false; });
  window.addEventListener('pointermove', e => {
    if (!isDragging) return;
    rotY += (e.clientX - prevX) * 0.008;
    rotX += (e.clientY - prevY) * 0.005;
    rotX = Math.max(-1, Math.min(1, rotX));
    prevX = e.clientX; prevY = e.clientY;
  });
  
  // Resume auto-rotate after 3s of no interaction
  let idleTimer;
  renderer.domElement.addEventListener('pointerup', () => {
    clearTimeout(idleTimer);
    idleTimer = setTimeout(() => { autoRotate = true; }, 3000);
  });
  
  // Hover detection with full chain tracing
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  const hoverEl = document.getElementById('crystal-hover');
  
  // Build adjacency for chain tracing
  const upstream = {}, downstream = {};
  Object.entries(d.theorems||{}).forEach(([tid,t])=>{
    (t.dependencies||[]).forEach(dep=>{
      const cd=cleanDep(dep);
      if(cd&&allIds.has(cd)){
        if(!downstream[cd])downstream[cd]=new Set();downstream[cd].add(tid);
        if(!upstream[tid])upstream[tid]=new Set();upstream[tid].add(cd);
      }
    });
  });
  
  function traceUp(id,visited=new Set()){visited.add(id);(upstream[id]||[]).forEach(p=>{if(!visited.has(p))traceUp(p,visited)});return visited}
  function traceDown(id,visited=new Set()){visited.add(id);(downstream[id]||[]).forEach(c=>{if(!visited.has(c))traceDown(c,visited)});return visited}
  
  renderer.domElement.addEventListener('pointermove', e => {
    if (isDragging) return;
    const rect = renderer.domElement.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
    
    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(nodeMeshes);
    
    if (hits.length > 0) {
      const ud = hits[0].object.userData;
      const col = TC[ud.tier] || '#f87171';
      
      // Trace full chains
      const upSet = traceUp(ud.id);
      const downSet = traceDown(ud.id);
      const fullChain = new Set([...upSet, ...downSet]);
      const upCount = upSet.size - 1;
      const downCount = downSet.size - 1;
      
      // Get direct deps
      const directUp = [...(upstream[ud.id]||[])].join(', ') || (ud.tier===-1?'(axiom)':'none');
      const directDown = [...(downstream[ud.id]||[])].slice(0,6).join(', ') + ((downstream[ud.id]||[]).size>6?' ':'');
      
      hoverEl.innerHTML = `<div style="font-weight:700;color:${col};font-size:12px">${ud.id}</div><div style="font-size:12px;margin:2px 0">${ud.name}</div><div style="font-size:11px;color:#4a5575">Tier ${ud.tier===-1?'A':ud.tier}  [${ud.epistemic}]</div><div style="font-size:11px;color:#60a5fa;margin-top:4px"> ancestors: ${upCount} <span style="color:#4a5575"> ${directUp}</span></div><div style="font-size:11px;color:#34d399"> descendants: ${downCount} <span style="color:#4a5575"> ${directDown||'(leaf)'}</span></div>`;
      hoverEl.style.opacity = '1';
      
      // Highlight full chain
      edgeLines.forEach(el => {
        const onChain = fullChain.has(el.source) && fullChain.has(el.target);
        el.line.material.opacity = onChain ? 0.55 : 0.02;
        if (onChain) {
          const isUp = upSet.has(el.source) && upSet.has(el.target);
          el.line.material.color.setHex(isUp ? 0x60a5fa : 0x34d399);
        }
      });
      nodeMeshes.forEach(m => {
        if (m === hits[0].object) {
          m.material.emissiveIntensity = 1.0;
          m.material.opacity = 1;
        } else if (fullChain.has(m.userData.id)) {
          const isUp = upSet.has(m.userData.id);
          m.material.emissiveIntensity = 0.6;
          m.material.opacity = 0.9;
          m.material.emissive.setHex(isUp ? 0x60a5fa : 0x34d399);
        } else {
          m.material.opacity = 0.08;
          m.material.emissiveIntensity = 0.1;
        }
      });
    } else {
      hoverEl.style.opacity = '0';
      edgeLines.forEach(el => {
        const sTier = d.theorems?.[el.source]?.tier??(el.source.startsWith('A')?-1:0);
        const tTier = d.theorems?.[el.target]?.tier??0;
        const dist = Math.abs(sTier-tTier);
        el.line.material.opacity = dist>2?0.06:dist>1?0.1:0.15;
        const restoreCol = colorMap[String(tTier)] || 0x888888;
        el.line.material.color.setHex(restoreCol);
      });
      nodeMeshes.forEach(m => {
        const origCol = colorMap[String(m.userData.tier)] || 0x888888;
        m.material.emissive.setHex(origCol);
        m.material.opacity = m.userData.tier===-1?0.9:0.85;
        m.material.emissiveIntensity = m.userData.tier===-1?0.5:0.35;
      });
    }
  });
  
  // Animation
  function animate() {
    requestAnimationFrame(animate);
    if (autoRotate) rotY += 0.003;
    crystalGroup.rotation.y = rotY;
    crystalGroup.rotation.x = rotX;
    renderer.render(scene, camera);
  }
  animate();
  
  // Resize
  window.addEventListener('resize', () => {
    const w = container.clientWidth, h = container.clientHeight;
    camera.aspect = w/h;
    camera.updateProjectionMatrix();
    renderer.setSize(w, h);
  });
}

let _sim,_svg,_zb;
function buildForceGraph(d){
const box=document.getElementById('graph-box'),W=box.clientWidth,H=box.clientHeight;
const nodes=[],edges=[],seen=new Set(),fanout={};
for(const[ax,nm]of Object.entries(AXNM)){nodes.push({id:ax,tier:-1,epistemic:'axiom',name:nm,label:ax});seen.add(ax)}
for(const[tid,t]of Object.entries(d.theorems||{}))for(const dep of(t.dependencies||[])){const cd=cD(dep);if(cd)fanout[cd]=(fanout[cd]||0)+1}
for(const[tid,t]of Object.entries(d.theorems||{})){nodes.push({id:tid,tier:t.tier??0,epistemic:t.epistemic||'P',name:(t.name||tid).replace(/^[^:]+:\s*/,'').slice(0,28),label:tid});seen.add(tid)}
for(const[tid,t]of Object.entries(d.theorems||{}))for(const dep of(t.dependencies||[])){const cd=cD(dep);if(cd&&seen.has(cd))edges.push({source:cd,target:tid})}
function cD(dep){let dd=dep.trim();if(dd.startsWith('A')&&dd.includes(' '))dd=dd.split(' ')[0].split('(')[0].trim();if(dd.startsWith('meaning'))return null;const rm={'L_epsilon*':'L_*','L_e*':'L_*','_closure':'Gamma_closure'};return rm[dd]||dd}
function nC(n){return n.tier===-1?AC:TC[n.tier]||'#888'}
function nR(n){return n.tier===-1?9+(fanout[n.id]||0)*.6:5+(fanout[n.id]||0)*1}
const svg=d3.select('#graph-box').append('svg').attr('width',W).attr('height',H);_svg=svg;
const g=svg.append('g');_zb=d3.zoom().scaleExtent([.2,4]).filter(ev=>ev.type!=='wheel').on('zoom',e=>g.attr('transform',e.transform));svg.call(_zb);
svg.append('defs').append('marker').attr('id','arr').attr('viewBox','0 -3 6 6').attr('refX',10).attr('refY',0).attr('markerWidth',5).attr('markerHeight',5).attr('orient','auto').append('path').attr('d','M0,-2.5L5,0L0,2.5').attr('fill','#2a3452');
const sim=d3.forceSimulation(nodes).force('link',d3.forceLink(edges).id(d=>d.id).distance(50).strength(.45)).force('charge',d3.forceManyBody().strength(-150)).force('center',d3.forceCenter(W/2,H/2)).force('y',d3.forceY().y(n=>n.tier===-1?H*.07:H*.1+n.tier*(H*.15)).strength(.38)).force('collision',d3.forceCollide().radius(n=>nR(n)+3));_sim=sim;
const link=g.append('g').selectAll('line').data(edges).join('line').attr('stroke','#1a2540').attr('stroke-width',1).attr('marker-end','url(#arr)');
const node=g.append('g').selectAll('g').data(nodes).join('g').call(d3.drag().on('start',(ev,n)=>{if(!ev.active)sim.alphaTarget(.3).restart();n.fx=n.x;n.fy=n.y}).on('drag',(ev,n)=>{n.fx=ev.x;n.fy=ev.y}).on('end',(ev,n)=>{if(!ev.active)sim.alphaTarget(0);n.fx=null;n.fy=null}));
node.each(function(n){const el=d3.select(this),r=nR(n),col=nC(n);if(n.tier===-1){const s=r*1.1;el.append('polygon').attr('points',`0,${-s} ${s},0 0,${s} ${-s},0`).attr('fill',col+'30').attr('stroke',col).attr('stroke-width',1.5)}else if(n.epistemic==='P_structural'){const s=r*.85;el.append('rect').attr('x',-s).attr('y',-s).attr('width',s*2).attr('height',s*2).attr('rx',2).attr('transform','rotate(45)').attr('fill',col+'25').attr('stroke',col).attr('stroke-width',1.5).attr('stroke-dasharray','3,2')}else{el.append('circle').attr('r',r).attr('fill',col+'25').attr('stroke',col).attr('stroke-width',1.5)}});
node.append('text').text(n=>n.label.replace('Gamma_','_')).attr('text-anchor','middle').attr('dy',n=>nR(n)+11).attr('fill',n=>nC(n)).attr('font-family','IBM Plex Mono').attr('font-size',n=>n.tier===-1?9:7).attr('font-weight',n=>n.tier===-1?700:500).attr('opacity',.85);
const tt=document.getElementById('gtt');
node.on('mouseover',(ev,n)=>{const deps=(d.theorems?.[n.id]?.dependencies||[]).join(', ')||(n.tier===-1?'axiom':'');const fo=fanout[n.id]||0;tt.innerHTML=`<div class="tt-id" style="color:${nC(n)}">${n.label}</div><div>${n.name}</div><div class="tt-dm">Tier ${n.tier===-1?'A':n.tier}  [${n.epistemic}]</div><div class="tt-dm"> ${deps}</div><div class="tt-dm">${fo} downstream</div>`;tt.classList.add('show');link.attr('stroke',l=>(l.source.id===n.id||l.target.id===n.id)?nC(n):'#1a2540').attr('stroke-width',l=>(l.source.id===n.id||l.target.id===n.id)?2:1).attr('opacity',l=>(l.source.id===n.id||l.target.id===n.id)?1:.15);node.attr('opacity',n2=>{if(n2.id===n.id)return 1;return edges.some(e=>(e.source.id===n.id&&e.target.id===n2.id)||(e.target.id===n.id&&e.source.id===n2.id))?1:.12})}).on('mousemove',ev=>{const r=box.getBoundingClientRect();tt.style.left=(ev.clientX-r.left+14)+'px';tt.style.top=(ev.clientY-r.top-10)+'px'}).on('mouseout',()=>{tt.classList.remove('show');link.attr('stroke','#1a2540').attr('stroke-width',1).attr('opacity',1);node.attr('opacity',1)});
sim.on('tick',()=>{link.attr('x1',l=>l.source.x).attr('y1',l=>l.source.y).attr('x2',l=>l.target.x).attr('y2',l=>l.target.y);node.attr('transform',n=>`translate(${n.x},${n.y})`)});
}
function zoomG(f){if(_svg&&_zb)_svg.transition().duration(300).call(_zb.scaleBy,f)}
function resetG(){if(_svg&&_zb)_svg.transition().duration(500).call(_zb.transform,d3.zoomIdentity)}

/*  2D LAYERED DAG (interactive)  */


function buildDAG(d){
const box=document.getElementById('dag-box');if(!box)return;
const tiers={'-1':[]};
['A1','A2','A3','A4','A5'].forEach(ax=>tiers['-1'].push({id:ax,epistemic:'axiom'}));
Object.entries(d.theorems||{}).forEach(([id,t])=>{const tier=String(t.tier??0);if(!tiers[tier])tiers[tier]=[];tiers[tier].push({id,epistemic:t.epistemic||'P'})});
const tierOrder=['-1','0','1','2','3','4','5'].filter(k=>tiers[k]&&tiers[k].length);
const colW=68,rowH=68,padL=16,padT=36;
const maxCols=Math.max(...tierOrder.map(k=>tiers[k].length));
const W=Math.max(padL*2+maxCols*colW,750);
const H=padT+tierOrder.length*rowH+20;
const pos={};
tierOrder.forEach((tier,ri)=>{const nodes=tiers[tier];const totalW=nodes.length*colW;const startX=(W-totalW)/2+colW/2;nodes.forEach((n,ci)=>{pos[n.id]={x:startX+ci*colW,y:padT+ri*rowH+20}})});
function cDep(dep){let dd=dep.trim();if(dd.startsWith('A')&&dd.includes(' '))dd=dd.split(' ')[0].split('(')[0].trim();if(dd.startsWith('meaning'))return null;const rm={'L_epsilon*':'L_*','L_e*':'L_*','_closure':'Gamma_closure'};return rm[dd]||dd}
const edgeData=[];const seen=new Set(Object.keys(pos));
const dagUp={},dagDown={};
Object.entries(d.theorems||{}).forEach(([tid,t])=>{for(const dep of(t.dependencies||[])){const dd=cDep(dep);if(dd&&seen.has(dd)&&seen.has(tid)){edgeData.push({s:dd,t:tid});if(!dagDown[dd])dagDown[dd]=new Set();dagDown[dd].add(tid);if(!dagUp[tid])dagUp[tid]=new Set();dagUp[tid].add(dd)}}});
function dagTraceUp(id,v=new Set()){v.add(id);(dagUp[id]||[]).forEach(p=>{if(!v.has(p))dagTraceUp(p,v)});return v}
function dagTraceDown(id,v=new Set()){v.add(id);(dagDown[id]||[]).forEach(c=>{if(!v.has(c))dagTraceDown(c,v)});return v}

let svg=`<svg viewBox="0 0 ${W} ${H}" style="width:100%;min-width:${W}px;height:${H}px">`;
tierOrder.forEach((tier,ri)=>{const y=padT+ri*rowH+20;svg+=`<text x="6" y="${y+3}" fill="${tier==='-1'?AC:TC[tier]||'#888'}" font-size="7.5" font-weight="600" opacity=".4">${tier==='-1'?'Axioms':'Tier '+tier}</text>`});
edgeData.forEach((e,i)=>{const s=pos[e.s],t=pos[e.t];if(s&&t)svg+=`<line class="dag-edge" data-s="${e.s}" data-t="${e.t}" x1="${s.x}" y1="${s.y+9}" x2="${t.x}" y2="${t.y-9}" stroke="#1a2540" stroke-width="0.6" opacity="0.4"/>`});
Object.entries(pos).forEach(([id,p])=>{const isAx=id.startsWith('A')&&id.length<=2;const thm=d.theorems?.[id];const tier=isAx?-1:(thm?.tier??0);const epi=isAx?'axiom':(thm?.epistemic||'P');const col=isAx?AC:TC[tier]||'#888';const r=isAx?7:5.5;const nm=(thm?.name||id).replace(/^[^:]+:\s*/,'').slice(0,30);
svg+=`<g class="dag-node" data-id="${id}" data-tier="${tier}" data-epi="${epi}" data-name="${nm}" style="cursor:pointer">`;
if(epi==='P_structural'){const s=r*.7;svg+=`<rect x="${p.x-s}" y="${p.y-s}" width="${s*2}" height="${s*2}" rx="1" transform="rotate(45,${p.x},${p.y})" fill="${col}30" stroke="${col}" stroke-width=".8" stroke-dasharray="2,1.5"/>`}
else if(isAx){svg+=`<polygon points="${p.x},${p.y-r} ${p.x+r},${p.y} ${p.x},${p.y+r} ${p.x-r},${p.y}" fill="${col}30" stroke="${col}" stroke-width="1"/>`}
else{svg+=`<circle cx="${p.x}" cy="${p.y}" r="${r}" fill="${col}25" stroke="${col}" stroke-width=".8"/>`}
svg+=`<text x="${p.x}" y="${p.y+r+9}" text-anchor="middle" fill="${col}" font-size="6" font-weight="${isAx?700:500}" opacity=".75">${id.replace('Gamma_','_')}</text></g>`});
svg+=`</svg>`;box.innerHTML=svg;

// Add tooltip div
const ttDiv=document.createElement('div');ttDiv.className='gtt';ttDiv.id='dag-tt';ttDiv.style.cssText='position:absolute;top:0;left:0;z-index:20';box.style.position='relative';box.appendChild(ttDiv);

// Attach hover events
box.querySelectorAll('.dag-node').forEach(el=>{
  el.addEventListener('mouseenter',()=>{
    const id=el.dataset.id,tier=el.dataset.tier,epi=el.dataset.epi,nm=el.dataset.name;
    const upSet=dagTraceUp(id),downSet=dagTraceDown(id),full=new Set([...upSet,...downSet]);
    const col=tier==='-1'?AC:TC[parseInt(tier)]||'#888';
    ttDiv.innerHTML=`<div class="tt-id" style="color:${col}">${id}</div><div>${nm}</div><div class="tt-dm"> ${upSet.size-1} ancestors   ${downSet.size-1} descendants</div>`;
    ttDiv.classList.add('show');
    box.querySelectorAll('.dag-edge').forEach(edge=>{
      const onChain=full.has(edge.dataset.s)&&full.has(edge.dataset.t);
      const isUp=upSet.has(edge.dataset.s)&&upSet.has(edge.dataset.t);
      edge.setAttribute('opacity',onChain?'0.7':'0.05');
      edge.setAttribute('stroke',onChain?(isUp?'#60a5fa':'#34d399'):'#1a2540');
      edge.setAttribute('stroke-width',onChain?'1.5':'0.6');
    });
    box.querySelectorAll('.dag-node').forEach(n=>{n.style.opacity=full.has(n.dataset.id)?'1':'0.12'});
  });
  el.addEventListener('mousemove',ev=>{
    const r=box.getBoundingClientRect();ttDiv.style.left=(ev.clientX-r.left+14)+'px';ttDiv.style.top=(ev.clientY-r.top-10)+'px';
  });
  el.addEventListener('mouseleave',()=>{
    ttDiv.classList.remove('show');
    box.querySelectorAll('.dag-edge').forEach(edge=>{edge.setAttribute('opacity','0.4');edge.setAttribute('stroke','#1a2540');edge.setAttribute('stroke-width','0.6')});
    box.querySelectorAll('.dag-node').forEach(n=>{n.style.opacity='1'});
  });
});
}



main();
</script></body></html>
